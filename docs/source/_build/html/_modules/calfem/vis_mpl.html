

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>calfem.vis_mpl &mdash; CALFEM for Python 3.5.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CALFEM for Python
          

          
          </a>

          
            
            
              <div class="version">
                3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_examples.html">Using CALFEM for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_mesh_guide.html">Mesh generation with CALFEM</a></li>
</ul>
<p class="caption"><span class="caption-text">Function Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_reference.html">Function reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CALFEM for Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>calfem.vis_mpl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for calfem.vis_mpl</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.collections</span>
<span class="kn">import</span> <span class="nn">matplotlib.path</span> <span class="k">as</span> <span class="nn">mpp</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">tri</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not import Matplotlib backends. Probarbly due to missing Qt.&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">atan2</span>

<span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">cflog</span>


<div class="viewcode-block" id="error"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.error">[docs]</a><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log error message&quot;&quot;&quot;</span>
    <span class="n">cflog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="info"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.info">[docs]</a><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log information message&quot;&quot;&quot;</span>
    <span class="n">cflog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="figure_class"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.figure_class">[docs]</a><span class="k">def</span> <span class="nf">figure_class</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return visvis Figure class.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="n">figureClass</span> <span class="o">=</span> <span class="n">figure_class</span>

<span class="n">cfv_def_mappable</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">set_mappable</span><span class="p">(</span><span class="n">mappable</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">cfv_def_mappable</span>
    <span class="n">cfv_def_mappable</span> <span class="o">=</span> <span class="n">mappable</span>


<div class="viewcode-block" id="colorbar"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.colorbar">[docs]</a><span class="k">def</span> <span class="nf">colorbar</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a colorbar to current figure&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cfv_def_mappable</span>
    <span class="k">if</span> <span class="n">cfv_def_mappable</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="o">=</span><span class="n">cfv_def_mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cfv_def_mappable</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cbar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="figure"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.figure">[docs]</a><span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Create a visvis figure with extras.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">figure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span></div>


<span class="k">def</span> <span class="nf">figure_widget</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parent</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">widget</span>


<div class="viewcode-block" id="close_all"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.close_all">[docs]</a><span class="k">def</span> <span class="nf">close_all</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Close all visvis windows.&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<span class="n">closeAll</span> <span class="o">=</span> <span class="n">close_all</span>


<div class="viewcode-block" id="clf"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.clf">[docs]</a><span class="k">def</span> <span class="nf">clf</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Clear visvis figure&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>


<div class="viewcode-block" id="gca"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.gca">[docs]</a><span class="k">def</span> <span class="nf">gca</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get current axis of the current visvis figure.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">gcf</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>


<div class="viewcode-block" id="subplot"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.subplot">[docs]</a><span class="k">def</span> <span class="nf">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a visvis subplot.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="camera3d"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.camera3d">[docs]</a><span class="k">def</span> <span class="nf">camera3d</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get visvis 3D camera.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="show_and_wait"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.show_and_wait">[docs]</a><span class="k">def</span> <span class="nf">show_and_wait</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Wait for plot to show&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="n">showAndWait</span> <span class="o">=</span> <span class="n">show_and_wait</span>


<div class="viewcode-block" id="show_and_wait_mpl"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.show_and_wait_mpl">[docs]</a><span class="k">def</span> <span class="nf">show_and_wait_mpl</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Wait for plot to show&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="n">showAndWaitMpl</span> <span class="o">=</span> <span class="n">show_and_wait_mpl</span>


<span class="k">def</span> <span class="nf">set_figure_dpi</span><span class="p">(</span><span class="n">dpi</span><span class="p">):</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>


<span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="n">add_text</span> <span class="o">=</span> <span class="n">text</span>
<span class="n">addText</span> <span class="o">=</span> <span class="n">text</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">text</span>


<div class="viewcode-block" id="ce2vf"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.ce2vf">[docs]</a><span class="k">def</span> <span class="nf">ce2vf</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Duplicate code. Extracts verts, faces and verticesPerFace from input.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">is_3d</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># pad with zeros to make 3D</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">is_3d</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">coords</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;coords must be N-by-2 or N-by-3 array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">el_type</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>  <span class="c1"># elements with triangular faces</span>
        <span class="n">vertices_per_face</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">el_type</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">]:</span>  <span class="c1"># elements with rectangular faces</span>
        <span class="n">vertices_per_face</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># [NOTE] This covers all element types available in CALFEM plus tetrahedrons. If more element types are added it is necessary to include them here and below.</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;element type not implemented&#39;</span><span class="p">)</span>

    <span class="n">faces</span> <span class="o">=</span> <span class="p">(</span><span class="n">edof</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="n">dofs_per_node</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dofs_per_node</span>
    <span class="c1"># &#39;faces&#39; here are actually lists of nodes in elements, not in faces necessarily if the elements are in 3D. This case is handled below.</span>

    <span class="k">if</span> <span class="n">el_type</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>  <span class="c1"># if hexahedrons or tetrahedrons:</span>
        <span class="k">if</span> <span class="n">el_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>  <span class="c1"># G is an array that is used to decomposes hexahedrons into its component faces.</span>
           <span class="c1"># The numbers are from the node orders (see p94 in the Gmsh manual) and each row makes one face.</span>
        <span class="k">elif</span> <span class="n">el_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>  <span class="c1"># This G decomposes tetrahedrons into faces</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">G</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
    <span class="k">elif</span> <span class="n">el_type</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>  <span class="c1"># if 8-node-quads:</span>
        <span class="c1"># The first 4 nodes are the corners of the high order quad.</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">verts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">vertices_per_face</span><span class="p">,</span> <span class="n">is_3d</span></div>


<div class="viewcode-block" id="draw_mesh"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_mesh">[docs]</a><span class="k">def</span> <span class="nf">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">face_color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">node_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Draws wire mesh of model in 2D or 3D. Returns the Mesh object that represents</span>
<span class="sd">    the mesh.</span>
<span class="sd">    Args:</span>
<span class="sd">        coords:</span>
<span class="sd">            An N-by-2 or N-by-3 array. Row i contains the x,y,z coordinates of node i.</span>
<span class="sd">        edof:</span>
<span class="sd">            An E-by-L array. Element topology. (E is the number of elements and L is the number of dofs per element)</span>
<span class="sd">        dofs_per_nodes:</span>
<span class="sd">            Integer. Dofs per node.</span>
<span class="sd">        el_type:</span>
<span class="sd">            Integer. Element Type. See Gmsh manual for details. Usually 2 for triangles or 3 for quadrangles.</span>
<span class="sd">        axes:</span>
<span class="sd">            Matplotlib Axes. The Axes where the model will be drawn. If unspecified the current Axes will be used, or a new Axes will be created if none exist.</span>
<span class="sd">        axes_adjust:</span>
<span class="sd">            Boolean. True if the view should be changed to show the whole model. Default True.</span>
<span class="sd">        title:</span>
<span class="sd">            String. Changes title of the figure. Default &quot;Mesh&quot;.</span>
<span class="sd">        color: </span>
<span class="sd">            3-tuple or char. Color of the wire. Defaults to black (0,0,0). Can also be given as a character in &#39;rgbycmkw&#39;.</span>
<span class="sd">        face_color:</span>
<span class="sd">            3-tuple or char. Color of the faces. Defaults to white (1,1,1). Parameter filled must be True or faces will not be drawn at all.</span>
<span class="sd">        filled:</span>
<span class="sd">            Boolean. Faces will be drawn if True. Otherwise only the wire is drawn. Default False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">verts</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">vertices_per_face</span><span class="p">,</span> <span class="n">is_3d</span> <span class="o">=</span> <span class="n">ce2vf</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">quatrangles</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">yz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">yz</span><span class="p">[</span><span class="n">quatrangles</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">(</span>
                <span class="n">v</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">face_color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">(</span>
                <span class="n">v</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pc</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">pc</span> <span class="o">=</span> <span class="n">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_nodes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">node_color</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<span class="n">drawMesh</span> <span class="o">=</span> <span class="n">draw_mesh</span>


<div class="viewcode-block" id="draw_element_values"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_element_values">[docs]</a><span class="k">def</span> <span class="nf">draw_element_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">,</span> <span class="n">displacements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw_undisplaced_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">magnfac</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">node_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Draws scalar element values in 2D or 3D. </span>

<span class="sd">    Args:</span>
<span class="sd">        ev: </span>
<span class="sd">            An N-by-1 array or a list of scalars. The Scalar values of the elements. ev[i] should be the value of element i.</span>
<span class="sd">    </span>
<span class="sd">        coords:</span>
<span class="sd">            An N-by-2 or N-by-3 array. Row i contains the x,y,z coordinates of node i.</span>

<span class="sd">        edof:</span>
<span class="sd">            An E-by-L array. Element topology. (E is the number of elements and L is the number of dofs per element)</span>

<span class="sd">        dofs_per_node:</span>
<span class="sd">            Integer. Dofs per node.</span>

<span class="sd">        el_type: </span>
<span class="sd">            Integer. Element Type. See Gmsh manual for details. Usually 2 for triangles or 3 for quadrangles.</span>
<span class="sd">    </span>
<span class="sd">        displacements:</span>
<span class="sd">            An N-by-2 or N-by-3 array. Row i contains the x,y,z displacements of node i.</span>
<span class="sd">    </span>
<span class="sd">        draw_mesh:</span>
<span class="sd">            Boolean. True if mesh wire should be drawn. Default True.</span>

<span class="sd">        draw_undisplaced_mesh: </span>
<span class="sd">            Boolean. True if the wire of the undisplaced mesh should be drawn on top of the displaced mesh. Default False. Use only if displacements != None.</span>

<span class="sd">        magnfac: </span>
<span class="sd">            Float. Magnification factor. Displacements are multiplied by this value. Use this to make small displacements more visible.</span>

<span class="sd">        title: </span>
<span class="sd">            String. Changes title of the figure. Default &quot;Element Values&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">draw_undisplaced_mesh</span><span class="p">:</span>
        <span class="n">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">displacements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">displacements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">displacements</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">magnfac</span> <span class="o">*</span> <span class="n">displacements</span><span class="p">)</span>

    <span class="n">verts</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">vertices_per_face</span><span class="p">,</span> <span class="n">is_3d</span> <span class="o">=</span> <span class="n">ce2vf</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">quatrangles</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">yz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">yz</span><span class="p">[</span><span class="n">quatrangles</span><span class="p">]</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">pc</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pc</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_elements</span><span class="p">:</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                      <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                      <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># pc = quatplot(y,z, np.asarray(edof-1), values, ax=ax,</span>
    <span class="c1">#         edgecolor=&quot;crimson&quot;, cmap=&quot;rainbow&quot;)</span>

    <span class="n">set_mappable</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_displacements"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_displacements">[docs]</a><span class="k">def</span> <span class="nf">draw_displacements</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">,</span> <span class="n">draw_undisplaced_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">magnfac</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">magscale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">node_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Draws scalar element values in 2D or 3D. Returns the world object</span>
<span class="sd">    elementsWobject that represents the mesh.</span>

<span class="sd">    Args:</span>
<span class="sd">        ev: </span>
<span class="sd">            An N-by-1 array or a list of scalars. The Scalar values of the elements. ev[i] should be the value of element i.</span>
<span class="sd">        coords: </span>
<span class="sd">            An N-by-2 or N-by-3 array. Row i contains the x,y,z coordinates of node i.</span>
<span class="sd">        edof: </span>
<span class="sd">            An E-by-L array. Element topology. (E is the number of elements and L is the number of dofs per element)</span>
<span class="sd">        dofs_per_node: </span>
<span class="sd">            Integer. Dofs per node.</span>
<span class="sd">        el_type: </span>
<span class="sd">            Integer. Element Type. See Gmsh manual for details. Usually 2 for triangles or 3 for quadrangles.</span>
<span class="sd">        displacements:  </span>
<span class="sd">            An N-by-2 or N-by-3 array. Row i contains the x,y,z  displacements of node i.</span>
<span class="sd">        axes: </span>
<span class="sd">            Matlotlib Axes. The Axes where the model will be drawn. If unspecified the current Axes will be used, or a new Axes will be created if none exist.</span>
<span class="sd">        draw_undisplaced_mesh:</span>
<span class="sd">            Boolean. True if the wire of the undisplaced mesh should be drawn on top of the displaced mesh. Default False. Use only if displacements != None.</span>
<span class="sd">        magnfac:        </span>
<span class="sd">            Float. Magnification factor. Displacements are multiplied by this value. Use this to make small displacements more visible.</span>
<span class="sd">        title:          </span>
<span class="sd">            String. Changes title of the figure. Default &quot;Element Values&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">draw_undisplaced_mesh</span><span class="p">:</span>
        <span class="n">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">x_size</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
            <span class="n">y_size</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>

            <span class="k">if</span> <span class="n">x_size</span> <span class="o">&gt;</span> <span class="n">y_size</span><span class="p">:</span>
                <span class="n">max_size</span> <span class="o">=</span> <span class="n">x_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_size</span> <span class="o">=</span> <span class="n">y_size</span>

            <span class="k">if</span> <span class="n">magnfac</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">magnfac</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">max_size</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">magnfac</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">verts</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">vertices_per_face</span><span class="p">,</span> <span class="n">is_3d</span> <span class="o">=</span> <span class="n">ce2vf</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span> <span class="n">el_type</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">quatrangles</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">yz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">yz</span><span class="p">[</span><span class="n">quatrangles</span><span class="p">]</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pc</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">pc</span> <span class="o">=</span> <span class="n">quatplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span>
        <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_ordered_polys"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.create_ordered_polys">[docs]</a><span class="k">def</span> <span class="nf">create_ordered_polys</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates ordered polygons from the geometry definition&quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">o_polys</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="p">(</span><span class="n">surf_name</span><span class="p">,</span> <span class="n">curve_ids</span><span class="p">,</span> <span class="n">holes</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">surfaces</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>

        <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">curve_id</span> <span class="ow">in</span> <span class="n">curve_ids</span><span class="p">:</span>

            <span class="n">curve_name</span><span class="p">,</span> <span class="n">curve_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">curves</span><span class="p">[</span><span class="n">curve_id</span><span class="p">]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">get_point_coords</span><span class="p">(</span><span class="n">curve_points</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">curve_name</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">_catmullspline</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curve_name</span> <span class="o">==</span> <span class="s2">&quot;BSpline&quot;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">_bspline</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curve_name</span> <span class="o">==</span> <span class="s2">&quot;Circle&quot;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">_circleArc</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curve_name</span> <span class="o">==</span> <span class="s2">&quot;Ellipse&quot;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">_ellipseArc</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

            <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

        <span class="n">ordered_polys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ordered_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polys</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ordered_polys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ordered_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polys</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">ordered_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">polys</span><span class="o">.</span><span class="n">pop</span><span class="p">()))</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ordered_polys</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">polygon</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

        <span class="n">o_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">o_polys</span></div>


<span class="k">def</span> <span class="nf">draw_ordered_polys</span><span class="p">(</span><span class="n">o_polys</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">o_polys</span><span class="p">:</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">mpp</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">poly</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">point_in_geometry</span><span class="p">(</span><span class="n">o_polys</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">o_polys</span><span class="p">:</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">mpp</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">poly</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">inside</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">contains_points</span><span class="p">([</span><span class="n">point</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">inside</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="topo_to_tri"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.topo_to_tri">[docs]</a><span class="k">def</span> <span class="nf">topo_to_tri</span><span class="p">(</span><span class="n">edof</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts 2d element topology to triangle topology to be used</span>
<span class="sd">    with the matplotlib functions tricontour and tripcolor.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">edof</span>
    <span class="k">elif</span> <span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">new_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_edof</span>
    <span class="k">elif</span> <span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">new_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">new_edof</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edof</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_edof</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;Element topology not supported.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_nodal_values_contourf"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_nodal_values_contourf">[docs]</a><span class="k">def</span> <span class="nf">draw_nodal_values_contourf</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">el_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_elements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws element nodal values as filled contours. Element topologies</span>
<span class="sd">    supported are triangles, 4-node quads and 8-node quads.&quot;&quot;&quot;</span>

    <span class="n">edof_tri</span> <span class="o">=</span> <span class="n">topo_to_tri</span><span class="p">(</span><span class="n">edof</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edof_tri</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">levels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dofs_per_node</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">el_type</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span>
                      <span class="n">el_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s2">&quot;dofs_per_node and el_type must be specified to draw the mesh.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_nodal_values_contour"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_nodal_values_contour">[docs]</a><span class="k">def</span> <span class="nf">draw_nodal_values_contour</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">el_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_elements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws element nodal values as filled contours. Element topologies</span>
<span class="sd">    supported are triangles, 4-node quads and 8-node quads.&quot;&quot;&quot;</span>

    <span class="n">edof_tri</span> <span class="o">=</span> <span class="n">topo_to_tri</span><span class="p">(</span><span class="n">edof</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edof_tri</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">levels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dofs_per_node</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">el_type</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span>
                      <span class="n">el_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s2">&quot;dofs_per_node and el_type must be specified to draw the mesh.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_nodal_values_shaded"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_nodal_values_shaded">[docs]</a><span class="k">def</span> <span class="nf">draw_nodal_values_shaded</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">el_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_elements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws element nodal values as shaded triangles. Element topologies</span>
<span class="sd">    supported are triangles, 4-node quads and 8-node quads.&quot;&quot;&quot;</span>

    <span class="n">edof_tri</span> <span class="o">=</span> <span class="n">topo_to_tri</span><span class="p">(</span><span class="n">edof</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edof_tri</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;gouraud&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dofs_per_node</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">el_type</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">draw_mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">dofs_per_node</span><span class="p">,</span>
                      <span class="n">el_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s2">&quot;dofs_per_node and el_type must be specified to draw the mesh.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<span class="n">draw_nodal_values</span> <span class="o">=</span> <span class="n">draw_nodal_values_contourf</span>


<div class="viewcode-block" id="draw_geometry"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.draw_geometry">[docs]</a><span class="k">def</span> <span class="nf">draw_geometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">draw_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_curves</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rel_margin</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">draw_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Draws the geometry (points and curves) in geoData</span>
<span class="sd">    Args:</span>
<span class="sd">        geoData:</span>
<span class="sd">            GeoData object. Geodata contains geometric information of the model.</span>
<span class="sd">        axes:</span>
<span class="sd">            Matplotlib Axes. The Axes where the model will be drawn. If unspecified the current Axes will be used, or a new Axes will be created if none exist.</span>
<span class="sd">        axes_adjust:</span>
<span class="sd">            Boolean. If True the view will be changed to show the whole model. Default True.</span>
<span class="sd">        draw_points: </span>
<span class="sd">            Boolean. If True points will be drawn.</span>
<span class="sd">        label_points:</span>
<span class="sd">            Boolean. If True Points will be labeled. The format is: ID[marker]. If a point has marker==0 only the ID is written.</span>
<span class="sd">        label_curves:</span>
<span class="sd">            Boolean. If True Curves will be labeled. The format is: ID(elementsOnCurve)[marker].</span>
<span class="sd">        font_size:</span>
<span class="sd">            Integer. Size of the text in the text labels. Default 11.</span>
<span class="sd">        N:</span>
<span class="sd">            Integer. The number of discrete points per curve segment. Default 20. Increase for smoother curves. Decrease for better performance.</span>
<span class="sd">        rel_margin:</span>
<span class="sd">            Extra spacing between geometry and axis</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="n">draw_axis</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_points</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">getPointCoords</span><span class="p">())</span>  <span class="c1"># M-by-3 list of M points.</span>
        <span class="c1">#plotArgs = {&#39;mc&#39;:&#39;r&#39;, &#39;mw&#39;:5, &#39;lw&#39;:0, &#39;ms&#39;:&#39;o&#39;, &#39;axesAdjust&#39;:False, &#39;axes&#39;:axes}</span>
        <span class="n">plotArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">is3D</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">plotArgs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">plotArgs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label_points</span><span class="p">:</span>  <span class="c1"># Write text label at the points:</span>
           <span class="c1"># [[x, y, z], elSize, marker]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">el_size</span><span class="p">,</span> <span class="n">marker</span><span class="p">))</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span>
                                         <span class="n">marker</span> <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">for</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="p">(</span><span class="n">curveName</span><span class="p">,</span> <span class="n">pointIDs</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">elementsOnCurve</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">getPointCoords</span><span class="p">(</span><span class="n">pointIDs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curveName</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">_catmullspline</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curveName</span> <span class="o">==</span> <span class="s2">&quot;BSpline&quot;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">_bspline</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curveName</span> <span class="o">==</span> <span class="s2">&quot;Circle&quot;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">_circleArc</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curveName</span> <span class="o">==</span> <span class="s2">&quot;Ellipse&quot;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">_ellipseArc</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="c1"># plotArgs = {&#39;lc&#39;:&#39;k&#39;, &#39;ms&#39;:None, &#39;axesAdjust&#39;:False, &#39;axes&#39;:axes} #Args for plot style. Black lines with no symbols at points.</span>

        <span class="c1"># Args for plot style. Black lines with no symbols at points.</span>
        <span class="n">plotArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">is3D</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">plotArgs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">plotArgs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label_curves</span><span class="p">:</span>
            <span class="c1"># Sort of midpoint along the curve. Where the text goes.</span>
            <span class="n">midP</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">7.0</span><span class="o">/</span><span class="mi">12</span><span class="p">),</span> <span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c1"># Create the text for the curve. Includes ID, elementsOnCurve, and marker:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elementsOnCurve</span><span class="p">)</span> <span class="k">if</span> <span class="n">elementsOnCurve</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="c1"># Something like &quot;4(5)[8]&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">marker</span><span class="p">)</span> <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">midP</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">midP</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bounding_box_2d</span><span class="p">()</span>

    <span class="n">g_width</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
    <span class="n">g_height</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>

    <span class="k">if</span> <span class="n">g_width</span> <span class="o">&gt;</span> <span class="n">g_height</span><span class="p">:</span>
        <span class="n">margin</span> <span class="o">=</span> <span class="n">rel_margin</span><span class="o">*</span><span class="n">g_width</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">margin</span> <span class="o">=</span> <span class="n">rel_margin</span><span class="o">*</span><span class="n">g_height</span>

    <span class="n">bottom</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">top</span><span class="o">+</span><span class="n">margin</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">right</span><span class="o">+</span><span class="n">margin</span><span class="p">)</span></div>

    <span class="c1"># if axesAdjust:</span>
    <span class="c1">#    _adjustaxes(axes, geoData.is3D)</span>
    <span class="c1">#axes.daspectAuto = False</span>
    <span class="c1">#axes.daspect = (1,1,1)</span>

<span class="c1"># drawGeometry = draw_geometry</span>


<span class="k">def</span> <span class="nf">_catmullspline</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">,</span> <span class="n">pointsOnEachSegment</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns points on a Catmull-Rom spline that interpolated the control points.</span>
<span class="sd">    Inital/end tangents are created by mirroring the second/second-to-last)</span>
<span class="sd">    control points in the first/last points.</span>

<span class="sd">    Params:</span>
<span class="sd">    controlPoints - Numpy array containing the control points of the spline.</span>
<span class="sd">                    Each row should contain the x,y,(z) values.</span>
<span class="sd">                    [[x1, y2],</span>
<span class="sd">                     [x2, y2],</span>
<span class="sd">                        ...</span>
<span class="sd">                     [xn, yn]]</span>

<span class="sd">    pointsOnEachSegment - The number of points on each segment of the curve.</span>
<span class="sd">                        If there are n control points and k samplesPerSegment,</span>
<span class="sd">                        then there will be (n+1)*k numeric points on the curve.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">controlPoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="n">controlPoints</span><span class="p">)</span>  <span class="c1"># Convert to array if input is a list.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">controlPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="c1"># If the curve is closed we extend each opposite endpoint to the other side</span>
        <span class="n">CPs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
                                     <span class="n">controlPoints</span><span class="p">,</span>
                                     <span class="n">controlPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Else make mirrored endpoints:</span>
        <span class="n">CPs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">controlPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
                                     <span class="n">controlPoints</span><span class="p">,</span>
                                     <span class="mi">2</span><span class="o">*</span><span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pointsOnEachSegment</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">T</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">CPs</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">CPs</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)]))</span>


<span class="k">def</span> <span class="nf">_bspline</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Uniform cubic B-spline.</span>

<span class="sd">    Params:</span>
<span class="sd">    controlPoints - Control points. Numpy array. One coordinate per row.</span>
<span class="sd">    pointsOnCurve - number of sub points per segment</span>

<span class="sd">    Mirrored start- and end-points are added if the curve is not closed.</span>
<span class="sd">    If the curve is closed some points are duplicated to make the closed</span>
<span class="sd">    spline continuous.</span>
<span class="sd">    (See http://www.cs.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/B-spline/bspline-curve-closed.html)</span>

<span class="sd">    Based on descriptions on:</span>
<span class="sd">    http://www.siggraph.org/education/materials/HyperGraph/modeling/splines/b_spline.htm</span>
<span class="sd">    http://en.wikipedia.org/wiki/B-spline#Uniform_cubic_B-splines</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">controlPoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="n">controlPoints</span><span class="p">)</span>  <span class="c1"># Convert to array if input is a list.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">controlPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="c1"># If the curve is closed we extend each opposite endpoint to the other side</span>
        <span class="n">CPs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
                                     <span class="n">controlPoints</span><span class="p">,</span>
                                     <span class="n">controlPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Else make mirrored endpoints:</span>
        <span class="n">CPs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">controlPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
                                     <span class="n">controlPoints</span><span class="p">,</span>
                                     <span class="mi">2</span><span class="o">*</span><span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">T</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">CPs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">CPs</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)]))</span>


<span class="k">def</span> <span class="nf">_circleArc</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_ellipseArc</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_ellipseArc</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">majAxP</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Input are 3D 1-by-3 numpy arrays or vectors&#39;&#39;&#39;</span>
    <span class="c1"># First part is to find a similarity transform in 3D that transform the ellipse to</span>
    <span class="c1"># the XY-plane with the center at the origin and the major axis of the ellipse along the X-axis.</span>

    <span class="c1"># convert to arrays in case inputs are lists:</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">majAxP</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="n">center</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">majAxP</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="n">zPrim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">start</span><span class="o">-</span><span class="n">center</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">center</span><span class="p">)</span>
    <span class="n">zPrim</span> <span class="o">=</span> <span class="n">zPrim</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">zPrim</span><span class="p">)</span>
    <span class="n">xPrim</span> <span class="o">=</span> <span class="p">(</span><span class="n">majAxP</span><span class="o">-</span><span class="n">center</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">majAxP</span><span class="o">-</span><span class="n">center</span><span class="p">)</span>
    <span class="n">yPrim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">zPrim</span><span class="p">,</span> <span class="n">xPrim</span><span class="p">)</span>

    <span class="c1"># Rotation matrix from ordinary coords to system where ellipse is in the XY-plane. (Actually hstack)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xPrim</span><span class="p">,</span> <span class="n">yPrim</span><span class="p">,</span> <span class="n">zPrim</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># Building Transformation matrix. -center is translation vector from ellipse center to origin.</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="c1"># Transformation matrix for homogenous coordinates.</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])))</span>

    <span class="n">startHC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># start and end points as column vectors in homogenous coordinates</span>
    <span class="n">endHC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">startHC</span>
    <span class="c1"># start and end points in the new coordinate system</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">endHC</span>

    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Just extract x &amp; y from the new start and endpoints</span>
    <span class="n">xe</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">ye</span><span class="o">*</span><span class="n">xs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">xe</span><span class="o">*</span><span class="n">ys</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">ye</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">ye</span><span class="o">*</span><span class="n">xs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">xe</span><span class="o">*</span><span class="n">ys</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">ye</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                                                   <span class="o">*</span> <span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">xe</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ye</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))))</span>

    <span class="c1"># atan2 is a function that goes from -pi to pi. It gives the signed angle from the X-axis to point (y,x)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">ys</span><span class="o">/</span><span class="n">b</span><span class="p">,</span> <span class="n">xs</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># We can&#39;t use the (transformed) start- and endpoints directly, but we divide x and y by the</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">ye</span><span class="o">/</span><span class="n">b</span><span class="p">,</span> <span class="n">xe</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># ellipse minor&amp;major axes to get the parameter t that corresponds to the point on the ellipse.</span>
    <span class="c1"># See ellipse formula: x = a * cos (t), y = b * sin(t).</span>
    <span class="c1"># So ts and te are the parameter values of the start- and endpoints (in the transformed coordinate system).</span>

    <span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="n">te</span><span class="p">:</span>
        <span class="c1"># swap if the start point comes before the endpoint in the parametric parameter that goes around the ellipse.</span>
        <span class="n">ts</span><span class="p">,</span> <span class="n">te</span> <span class="o">=</span> <span class="n">te</span><span class="p">,</span> <span class="n">ts</span>
    <span class="k">if</span> <span class="n">te</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="c1"># parameter of ellipse curve. NOT angle to point on curve (like it could be for a circle).</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">pointsOnCurve</span><span class="p">)</span>
    <span class="c1"># the shortest parameter distance between start- and end-point stradles the discontinuity that jumps from pi to -pi.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># number of points on the first length.</span>
        <span class="n">ps1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pointsOnCurve</span> <span class="o">*</span> <span class="p">(</span><span class="n">pi</span><span class="o">-</span><span class="n">te</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">-</span><span class="n">te</span><span class="o">+</span><span class="n">ts</span><span class="p">))</span>
        <span class="c1"># number of points on the first length.</span>
        <span class="n">ps2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pointsOnCurve</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts</span><span class="o">+</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">-</span><span class="n">te</span><span class="o">+</span><span class="n">ts</span><span class="p">))</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">ps1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ps2</span><span class="p">)))</span>

    <span class="n">ellArc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">a</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">b</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
                       <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># points on arc (in 2D)</span>
    <span class="c1"># Make 3D homogenous coords by adding rows of 0s and 1s.</span>
    <span class="n">ellArc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
        <span class="p">(</span><span class="n">ellArc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">ellArc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">ellArc</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">ellArc</span>  <span class="c1"># Transform back to the original coordinate system</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ellArc</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># return points as an N-by-3 array.</span>


<div class="viewcode-block" id="eldraw2"><a class="viewcode-back" href="../../calfem_reference.html#calfem.vis_mpl.eldraw2">[docs]</a><span class="k">def</span> <span class="nf">eldraw2</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">plotpar</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">elnum</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    eldraw2(ex,ey,plotpar,elnum)</span>
<span class="sd">    eldraw2(ex,ey,plotpar)</span>
<span class="sd">    eldraw2(ex,ey)</span>

<span class="sd">     PURPOSE</span>
<span class="sd">       Draw the undeformed 2D mesh for a number of elements of</span>
<span class="sd">       the same type. Supported elements are:</span>

<span class="sd">       1) -&gt; bar element              2) -&gt; beam el.</span>
<span class="sd">       3) -&gt; triangular 3 node el.    4) -&gt; quadrilateral 4 node el.</span>
<span class="sd">       5) -&gt; 8-node isopar. elemen</span>

<span class="sd">     INPUT</span>
<span class="sd">        ex,ey:.......... nen:   number of element nodes</span>
<span class="sd">                         nel:   number of elements</span>
<span class="sd">        plotpar=[ linetype, linecolor, nodemark]</span>

<span class="sd">                 linetype=1 -&gt; solid    linecolor=1 -&gt; black</span>
<span class="sd">                          2 -&gt; dashed             2 -&gt; blue</span>
<span class="sd">                          3 -&gt; dotted             3 -&gt; magenta</span>
<span class="sd">                                                  4 -&gt; red</span>

<span class="sd">                 nodemark=1 -&gt; circle</span>
<span class="sd">                          2 -&gt; star</span>
<span class="sd">                          0 -&gt; no mark</span>

<span class="sd">        elnum=edof(:,1) ; i.e. the first column in the topology matrix</span>

<span class="sd">        Rem. Default is solid white lines with circles at nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">line_type</span> <span class="o">=</span> <span class="n">plotpar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">line_color</span> <span class="o">=</span> <span class="n">plotpar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">node_mark</span> <span class="o">=</span> <span class="n">plotpar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Translate CALFEM plotpar to visvis</span>

    <span class="n">vv_line_type</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">vv_line_color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
    <span class="n">vv_node_mark</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>

    <span class="k">if</span> <span class="n">line_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vv_line_type</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="k">elif</span> <span class="n">line_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">vv_line_type</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span>
    <span class="k">elif</span> <span class="n">line_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">vv_line_type</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>

    <span class="k">if</span> <span class="n">line_color</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vv_line_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="k">elif</span> <span class="n">line_color</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">vv_line_color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
    <span class="k">elif</span> <span class="n">line_color</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">vv_line_color</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
    <span class="k">elif</span> <span class="n">line_color</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">vv_line_color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>

    <span class="k">if</span> <span class="n">node_mark</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vv_node_mark</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
    <span class="k">elif</span> <span class="n">node_mark</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">vv_node_mark</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">elif</span> <span class="n">node_mark</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vv_node_mark</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">vv_marker_color</span> <span class="o">=</span> <span class="n">vv_line_color</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">draw_element_numbers</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elnum</span><span class="p">)</span> <span class="o">==</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">draw_element_numbers</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">elx</span><span class="p">,</span> <span class="n">ely</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">elx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ely</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ely</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">xm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ym</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">vv_line_color</span> <span class="o">+</span> <span class="n">vv_node_mark</span> <span class="o">+</span> <span class="n">vv_line_type</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">eliso2_mpl</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ed</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span>

    <span class="n">gx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gz</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">elx</span><span class="p">,</span> <span class="n">ely</span><span class="p">,</span> <span class="n">scl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ed</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">elx</span><span class="p">:</span>
            <span class="n">gx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ely</span><span class="p">:</span>
            <span class="n">gy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">ely</span><span class="p">:</span>
            <span class="n">gz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2020, Jonas Lindemann.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>