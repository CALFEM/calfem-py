

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>calfem.core &mdash; CALFEM for Python 3.5.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CALFEM for Python
          

          
          </a>

          
            
            
              <div class="version">
                3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_examples.html">Using CALFEM for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_mesh_guide.html">Mesh generation with CALFEM</a></li>
</ul>
<p class="caption"><span class="caption-text">Function Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../calfem_reference.html">Function reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CALFEM for Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>calfem.core</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for calfem.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: iso-8859-15 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CALFEM Core module</span>

<span class="sd">Contains all the functions implementing CALFEM standard functionality</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">dsolve</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">cflog</span>

<div class="viewcode-block" id="error"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.error">[docs]</a><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write ``msg`` to error log.&quot;&quot;&quot;</span>
    <span class="n">cflog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot; calfem.core: &quot;</span><span class="o">+</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="info"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.info">[docs]</a><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write ``msg`` to info log.&quot;&quot;&quot;</span>
    <span class="n">cflog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; calfem.core: &quot;</span><span class="o">+</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="spring1e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.spring1e">[docs]</a><span class="k">def</span> <span class="nf">spring1e</span><span class="p">(</span><span class="n">ep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for spring element.</span>
<span class="sd">    </span>
<span class="sd">    :param float ep: spring stiffness or analog quantity (ep = k).</span>
<span class="sd">    :return mat Ke: stiffness matrix, dim(Ke)= 2 x 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">k</span><span class="p">],[</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="spring1s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.spring1s">[docs]</a><span class="k">def</span> <span class="nf">spring1s</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element force in spring element (spring1e).</span>
<span class="sd">    </span>
<span class="sd">    :param float ep: spring stiffness or analog quantity</span>
<span class="sd">    :param list ed: element displacements [d0, d1]</span>
<span class="sd">    :return float es: element force [N]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ed</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>   </div>

<div class="viewcode-block" id="bar1e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar1e">[docs]</a><span class="k">def</span> <span class="nf">bar1e</span><span class="p">(</span><span class="n">ep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for spring element.</span>
<span class="sd">    </span>
<span class="sd">    :param ep float: spring stiffness or analog quantity</span>
<span class="sd">    :return mat Ke: stiffness matrix, dim(Ke)= 2 x 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">k</span><span class="p">],[</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="bar1s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar1s">[docs]</a><span class="k">def</span> <span class="nf">bar1s</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element force in spring element (spring1e).</span>
<span class="sd">    </span>
<span class="sd">    :param float ep: spring stiffness or analog quantity</span>
<span class="sd">    :param list ed: element displacements [d0, d1]</span>
<span class="sd">    :return float es: element force</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ed</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>   </div>

<div class="viewcode-block" id="bar2e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar2e">[docs]</a><span class="k">def</span> <span class="nf">bar2e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the element stiffness matrix for two dimensional bar element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ep: [E, A]: E - Young&#39;s modulus, A - Cross section area</span>
<span class="sd">    :return mat Ke: stiffness matrix, [4 x 4]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]])</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span></div>

<div class="viewcode-block" id="bar2g"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar2g">[docs]</a><span class="k">def</span> <span class="nf">bar2g</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for two dimensional geometric</span>
<span class="sd">    nonlinear bar element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ep: element properties [E, A], E - Young&#39;s modulus, A - Cross section area</span>
<span class="sd">    :param float N: normal force</span>
<span class="sd">    :return mat Ke: stiffness matrix [4 x 4]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span>  <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>  <span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">])</span><span class="o">+</span><span class="n">N</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span></div>

<div class="viewcode-block" id="bar2s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar2s">[docs]</a><span class="k">def</span> <span class="nf">bar2s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute normal force in two dimensional bar element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ep: element properties [E, A], E - Young&#39;s modulus, A - Cross section area</span>
<span class="sd">    :param list ed: element displacements [u1, u2, u3, u4]    </span>
<span class="sd">    :return float N: element foce [N]    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    
    <span class="c1">#Kle = np.mat([[1.,-1.],[-1.,1.]])*E*A/L</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span> 
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">N</span><span class="o">=</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]])</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">u</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">N</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="bar3e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar3e">[docs]</a><span class="k">def</span> <span class="nf">bar3e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">ep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for three dimensional bar element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ez: element z coordinates [z1, z2]</span>
<span class="sd">    :param list ep: element properties [E, A], E - Young&#39;s modulus, A - Cross section area</span>
<span class="sd">    :return mat Ke: stiffness matrix, [6 x 6]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span></div>

<div class="viewcode-block" id="bar3s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.bar3s">[docs]</a><span class="k">def</span> <span class="nf">bar3s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute normal force in three dimensional bar element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ez: element z coordinates [z1, z2]</span>
<span class="sd">    :param list ep: element properties [E, A], E - Young&#39;s modulus, A - Cross section area   </span>
<span class="sd">    :param list ed: element displacements [u1, ..., u6]</span>
<span class="sd">    :return float N: normal force</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="c1">#Kle = E*A/L*np.mat([</span>
    <span class="c1">#    [ 1,-1],</span>
    <span class="c1">#    [-1, 1]</span>
    <span class="c1">#])</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]])</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">u</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">N</span><span class="p">)</span></div>

<div class="viewcode-block" id="beam2e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2e">[docs]</a><span class="k">def</span> <span class="nf">beam2e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the stiffness matrix for a two dimensional beam element.</span>
<span class="sd">    </span>
<span class="sd">    :param list ex: element x coordinates [x1, x2]</span>
<span class="sd">    :param list ey: element y coordinates [y1, y2]</span>
<span class="sd">    :param list ep: element properties [E, A, I], E - Young&#39;s modulus, A - Cross section area, I - Moment of inertia   </span>
<span class="sd">    :param list eq: distributed loads, local directions [qx, qy]</span>
<span class="sd">    :return mat Ke: element stiffness matrix [6 x 6]</span>
<span class="sd">    :return mat fe: element stiffness matrix [6 x 1] (if eq!=None)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span> 
    
    <span class="n">E</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">I</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">qx</span><span class="o">=</span><span class="mf">0.</span>
    <span class="n">qy</span><span class="o">=</span><span class="mf">0.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="o">=</span><span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qy</span><span class="o">=</span><span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>      <span class="mf">0.</span><span class="p">,</span>          <span class="mf">0.</span><span class="p">,</span>    <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>        <span class="mf">0.</span>      <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span> <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>      <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>          <span class="mf">0.</span><span class="p">,</span>     <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>        <span class="mf">0.</span>      <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>  <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span> <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>      <span class="mf">0.</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">]</span>
    <span class="p">])</span>
     
    <span class="n">fle</span><span class="o">=</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
     
    <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">1.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>  <span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Ke</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">fe</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">fle</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span></div>
    
<div class="viewcode-block" id="beam2s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2s">[docs]</a><span class="k">def</span> <span class="nf">beam2s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute section forces in two dimensional beam element (beam2e).</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1 x2]</span>
<span class="sd">        ey = [y1 y2]        element node coordinates</span>

<span class="sd">        ep = [E A I]        element properties,</span>
<span class="sd">                            E:  Young&#39;s modulus</span>
<span class="sd">                            A:  cross section area</span>
<span class="sd">                            I:  moment of inertia</span>

<span class="sd">        ed = [u1 ... u6]    element displacements</span>

<span class="sd">        eq = [qx qy]        distributed loads, local directions </span>

<span class="sd">        nep                 number of evaluation points ( default=2 )</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">          </span>
<span class="sd">        es = [ N1 V1 M1     section forces, local directions, in </span>
<span class="sd">               N2 V2 M2     n points along the beam, dim(es)= n x 3</span>
<span class="sd">               .........]  </span>
<span class="sd">           </span>
<span class="sd">        edi = [ u1 v1       element displacements, local directions,</span>
<span class="sd">                u2 v2       in n points along the beam, dim(es)= n x 2</span>
<span class="sd">                .......]    </span>

<span class="sd">            eci = [ x1      local x-coordinates of the evaluation </span>
<span class="sd">                    x2      points, (x1=0 and xn=L)</span>
<span class="sd">                    ...]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EA</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EI</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">qx</span><span class="o">=</span><span class="mf">0.</span>
    <span class="n">qy</span><span class="o">=</span><span class="mf">0.</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="o">=</span><span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qy</span><span class="o">=</span><span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
      
    <span class="n">ne</span><span class="o">=</span><span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">nep</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="n">nep</span>
        
    <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>    <span class="mf">1.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="n">L</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>    <span class="mf">1.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>   <span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="n">L</span><span class="p">,</span>    <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">]</span>
    <span class="p">])</span>
   
    <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">1.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>  <span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">),</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EI</span><span class="p">),</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EI</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">ne</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">ne</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">zero</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">one</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]))</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">A</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">qx</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">)</span>
    <span class="n">du</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">A</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">qx</span><span class="o">/</span><span class="n">EA</span>
    <span class="n">v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">qy</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span>
    <span class="n">d2v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">6</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">qy</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span>
    <span class="n">d3v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">6</span><span class="o">*</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">qy</span><span class="o">/</span><span class="n">EI</span>
    
    <span class="n">N</span><span class="o">=</span><span class="n">EA</span><span class="o">*</span><span class="n">du</span>
    <span class="n">M</span><span class="o">=</span><span class="n">EI</span><span class="o">*</span><span class="n">d2v</span>
    <span class="n">V</span><span class="o">=-</span><span class="n">EI</span><span class="o">*</span><span class="n">d3v</span>
    <span class="n">edi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eci</span><span class="o">=</span><span class="n">x</span>
    <span class="n">es</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">M</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">es</span><span class="p">,</span><span class="n">edi</span><span class="p">,</span><span class="n">eci</span><span class="p">)</span></div>

<div class="viewcode-block" id="beam2t"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2t">[docs]</a><span class="k">def</span> <span class="nf">beam2t</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the stiffness matrix for a two dimensional elastic</span>
<span class="sd">    Timoshenko beam element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">     </span>
<span class="sd">        ex = [x1 x2]</span>
<span class="sd">        ey = [y1 y2]        element node coordinates</span>
<span class="sd">    </span>
<span class="sd">        ep = [E G A I ks]   element properties</span>
<span class="sd">                              E: Young&#39;s modulus</span>
<span class="sd">                              G: Shear modulus</span>
<span class="sd">                              A: Cross section area</span>
<span class="sd">                              I: Moment of inertia</span>
<span class="sd">                             ks: Shear correction factor</span>
<span class="sd">    </span>
<span class="sd">        eq = [qx qy]        distributed loads, local directions</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">     </span>
<span class="sd">        Ke                  element stiffness matrix (6 x 6)</span>
<span class="sd">    </span>
<span class="sd">        fe                  element load vector (6 x 1)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Gm</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        
    <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="p">(</span><span class="n">Gm</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">ks</span><span class="p">))</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>      <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>        <span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>          <span class="mf">0.</span>      <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mi">12</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span>    <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>          <span class="mf">0.</span>      <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>        <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span>    <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">fle</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>  <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">fe</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">fle</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span></div>

<div class="viewcode-block" id="beam2ts"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2ts">[docs]</a><span class="k">def</span> <span class="nf">beam2ts</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute section forces in two dimensional beam element (beam2e).</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]       element node coordinates</span>

<span class="sd">        ep = [E,G,A,I,ks]   element properties,</span>
<span class="sd">                              E:  Young&#39;s modulus</span>
<span class="sd">                              G:  shear modulus</span>
<span class="sd">                              A:  cross section area</span>
<span class="sd">                              I:  moment of inertia</span>

<span class="sd">        ed = [u1, ... ,u6]  element displacements</span>

<span class="sd">        eq = [qx, qy]       distributed loads, local directions </span>

<span class="sd">        nep                 number of evaluation points ( default=2 )</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">          </span>
<span class="sd">        es = [[N1,V1,M1],   section forces, local directions, in </span>
<span class="sd">              [N2,V2,M2],   n points along the beam, dim(es)= n x 3</span>
<span class="sd">              ..........]  </span>
<span class="sd">    </span>
<span class="sd">        edi = [[u1,v1,teta1],   element displacements, local directions,</span>
<span class="sd">               [u2,v2,teta2],   and rotation of cross section at</span>
<span class="sd">               .............]   in n points along the beam, dim(es)= n x 2</span>
<span class="sd">    </span>
<span class="sd">    (Note! Rotation of the cross section is not equal to dv/dx for Timoshenko beam element)</span>
<span class="sd">    </span>
<span class="sd">        eci = [[x1],    local x-coordinates of the evaluation </span>
<span class="sd">               [x2],    points, (x1=0 and xn=L)</span>
<span class="sd">               ....]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EA</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">EI</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">GAK</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">alfa</span> <span class="o">=</span> <span class="n">EI</span><span class="o">/</span><span class="n">GAK</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
      
    <span class="n">ne</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">nep</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="n">nep</span>
        
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">alfa</span><span class="p">,</span>          <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="n">L</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>            <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">alfa</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    <span class="p">])</span>
   
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">),</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span><span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">GAK</span><span class="p">),</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EI</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">C4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">ne</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">ne</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]))</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C2</span><span class="o">-</span><span class="n">qx</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C2</span><span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">EA</span>
    
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C4</span><span class="o">+</span><span class="n">qy</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">qy</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">GAK</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C4</span><span class="o">+</span><span class="n">qy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span><span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">GAK</span>
    
    <span class="n">teta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">alfa</span><span class="o">*</span><span class="n">one</span><span class="p">),</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C4</span><span class="o">+</span><span class="n">qy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span>
    <span class="n">dteta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">6</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">C4</span><span class="o">+</span><span class="n">qy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EI</span><span class="p">)</span>
    
    <span class="n">N</span> <span class="o">=</span> <span class="n">EA</span><span class="o">*</span><span class="n">du</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">EI</span><span class="o">*</span><span class="n">dteta</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">GAK</span><span class="o">*</span><span class="p">(</span><span class="n">dv</span><span class="o">-</span><span class="n">teta</span><span class="p">)</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">M</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">edi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">teta</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eci</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">nep</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">edi</span><span class="p">,</span><span class="n">eci</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">es</span></div>

<div class="viewcode-block" id="beam2w"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2w">[docs]</a><span class="k">def</span> <span class="nf">beam2w</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the stiffness matrix for a two dimensional beam element</span>
<span class="sd">    on elastic foundation.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]       element node coordinates</span>

<span class="sd">        ep = [E,A,I,ka,kt]  element properties,</span>
<span class="sd">                              E:  Young&#39;s modulus</span>
<span class="sd">                              A:  cross section area</span>
<span class="sd">                              I:  moment of inertia</span>
<span class="sd">                             ka:  axial foundation stiffness</span>
<span class="sd">                             kt:  transversal foundation stiffness</span>

<span class="sd">        eq = [qx, qy]       distributed loads, local directions</span>

<span class="sd">    Returns:</span>

<span class="sd">        Ke                  beam stiffness matrix (6 x 6)</span>
<span class="sd">        </span>
<span class="sd">        fe                  element load vector (6 x 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">ka</span><span class="p">,</span><span class="n">kt</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">qx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="p">,</span><span class="n">qy</span> <span class="o">=</span> <span class="n">eq</span>
    
    <span class="n">K1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>         <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>          <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">]</span>
        <span class="p">])</span>
    
    <span class="n">K2</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="mi">420</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">140</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>         <span class="mi">70</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span>        <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">156</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>  <span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>      <span class="mi">54</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>  <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">70</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>         <span class="mi">140</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span>        <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">54</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>   <span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>      <span class="mi">156</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">K1</span><span class="o">+</span><span class="n">K2</span>
    <span class="n">fle</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">fe</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">fle</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span></div>
    
<div class="viewcode-block" id="beam2ws"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2ws">[docs]</a><span class="k">def</span> <span class="nf">beam2ws</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute section forces in a two dimensional beam element</span>
<span class="sd">    on elastic foundation.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]           element node coordinates</span>

<span class="sd">        ep = [E,A,I,ka,kt]      element properties,</span>
<span class="sd">                                  E:  Young&#39;s modulus</span>
<span class="sd">                                  A:  cross section area</span>
<span class="sd">                                  I:  moment of inertia</span>
<span class="sd">                                 ka:  axial foundation stiffness</span>
<span class="sd">                                 kt:  transversal foundation stiffness</span>

<span class="sd">        ed = [u1, ... ,u6]      element displacement vector</span>

<span class="sd">        eq = [qx, qy]           distributed loads, local directions</span>

<span class="sd">    Returns:</span>

<span class="sd">        es = [[N1, V1, M1],</span>
<span class="sd">              [N2, V2, M2]]     element forces, local direction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cferror</span><span class="p">(</span><span class="s2">&quot;Only one row is allowed in the ed matrix !!!&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">ka</span><span class="p">,</span><span class="n">kt</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">qx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="p">,</span><span class="n">qy</span> <span class="o">=</span> <span class="n">eq</span>
    
    <span class="n">K1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>         <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>          <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">]</span>
        <span class="p">])</span>
    
    <span class="n">K2</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="mi">420</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">140</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>         <span class="mi">70</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span>        <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">156</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>  <span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>      <span class="mi">54</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>  <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">70</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>         <span class="mi">140</span><span class="o">*</span><span class="n">ka</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span>        <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">54</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span>   <span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>      <span class="mi">156</span><span class="o">*</span><span class="n">kt</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">kt</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">K1</span><span class="o">+</span><span class="n">K2</span>
    <span class="n">fle</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">qx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">qy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">Kle</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">fle</span>

    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">es</span></div>

<div class="viewcode-block" id="beam2g"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2g">[docs]</a><span class="k">def</span> <span class="nf">beam2g</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the element stiffness matrix for a two dimensional</span>
<span class="sd">    beam element with respect to geometric nonlinearity.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]           element node coordinates</span>

<span class="sd">        ep = [E,A,I]            element properties;</span>
<span class="sd">                                  E:  Young&#39;s modulus</span>
<span class="sd">                                  A:  cross section area</span>
<span class="sd">                                  I:  moment of inertia</span>

<span class="sd">        N                       axial force in the beam</span>

<span class="sd">        eq                      distributed transverse load</span>

<span class="sd">    Returns:</span>

<span class="sd">        Ke                      element stiffness matrix (6 x 6)</span>
<span class="sd">        </span>
<span class="sd">        fe                      element load vector (6 x 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cferror</span><span class="p">(</span><span class="s2">&quot;eq should be a scalar !!!&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">rho</span> <span class="o">=</span> <span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
    
    <span class="n">kL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>

    <span class="k">if</span> <span class="n">rho</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.</span><span class="p">)</span><span class="o">*</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">f1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="o">-</span><span class="n">f1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kL</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">kL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kL</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.</span><span class="p">)</span><span class="o">*</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">f1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="o">-</span><span class="n">f1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">kL</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">kL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kL</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">f4</span> <span class="o">=</span> <span class="n">f5</span> <span class="o">=</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span><span class="p">,</span>            <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span>            <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>   <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f3</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>   <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f4</span><span class="o">/</span><span class="n">L</span>    <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span><span class="p">,</span>             <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>              <span class="mf">0.</span>            <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>   <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">3.</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f4</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>     <span class="mf">0.</span><span class="p">,</span>   <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f3</span><span class="o">/</span><span class="n">L</span>    <span class="p">]</span>
    <span class="p">])</span>

    <span class="n">fle</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">L</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">Ke</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">fe</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">fle</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span></div>
    
<div class="viewcode-block" id="beam2gs"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2gs">[docs]</a><span class="k">def</span> <span class="nf">beam2gs</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate section forces in a two dimensional nonlinear</span>
<span class="sd">    beam element.</span>

<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]           element node coordinates</span>

<span class="sd">        ep = [E,A,I]            element properties;</span>
<span class="sd">                                  E:  Young&#39;s modulus</span>
<span class="sd">                                  A:  cross section area</span>
<span class="sd">                                  I:  moment of inertia</span>

<span class="sd">        ed = [u1, ... ,u6]      element displacement vector</span>

<span class="sd">        N                       axial force</span>

<span class="sd">        eq = [qy]               distributed transverse load</span>

<span class="sd">    Returns:</span>

<span class="sd">        es = [[N1,V1,M1],       element forces, local directions</span>
<span class="sd">              [N2,V2,M2]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">rho</span> <span class="o">=</span> <span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
    
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">2.2204e-16</span>
    <span class="n">kL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span><span class="o">+</span><span class="n">eps</span>

    <span class="k">if</span> <span class="n">rho</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.</span><span class="p">)</span><span class="o">*</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">f1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="o">-</span><span class="n">f1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kL</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">kL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kL</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">kL</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.</span><span class="p">)</span><span class="o">*</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">f1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="o">-</span><span class="n">f1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">kL</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">kL</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">kL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kL</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">f4</span> <span class="o">=</span> <span class="n">f5</span> <span class="o">=</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>              <span class="mi">0</span><span class="p">,</span>            <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>              <span class="mi">0</span>            <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f3</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f4</span><span class="o">/</span><span class="n">L</span>   <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>              <span class="mi">0</span><span class="p">,</span>             <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>              <span class="mi">0</span>            <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f5</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f4</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">f3</span><span class="o">/</span><span class="n">L</span>   <span class="p">]</span>
    <span class="p">])</span>

    <span class="n">fle</span> <span class="o">=</span> <span class="n">eq</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">L</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Kle</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">u</span><span class="o">-</span><span class="n">fle</span>

    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">es</span></div>

<div class="viewcode-block" id="beam2d"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam2d">[docs]</a><span class="k">def</span> <span class="nf">beam2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix Ke, the mass matrix Me</span>
<span class="sd">    and the damping matrix Ce for a 2D elastic Bernoulli</span>
<span class="sd">    beam element.</span>

<span class="sd">    Parameters:</span>
<span class="sd"> </span>
<span class="sd">        ex = [x1, x2]</span>
<span class="sd">        ey = [y1, y2]           element node coordinates</span>

<span class="sd">        ep = [E,A,I,m,(a,b)]    element properties;</span>
<span class="sd">                                  E:  Young&#39;s modulus</span>
<span class="sd">                                  A:  cross section area</span>
<span class="sd">                                  I:  moment of inertia</span>
<span class="sd">                                  m:  mass per unit length</span>
<span class="sd">                                a,b:  damping coefficients,</span>
<span class="sd">                                      Ce=aMe+bKe</span>

<span class="sd">    Returns:</span>

<span class="sd">        Ke                      element stiffness matrix (6 x 6)</span>
<span class="sd">        Me                      element mass martix</span>
<span class="sd">        Ce                      element damping matrix, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">E</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>         <span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>          <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span>         <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">L</span>   <span class="p">]</span>
    <span class="p">])</span>

    <span class="n">Mle</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">420</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>      <span class="mi">70</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">156</span><span class="p">,</span>  <span class="mi">22</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">54</span><span class="p">,</span>  <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">22</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">13</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">70</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>      <span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">54</span><span class="p">,</span>   <span class="mi">13</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">156</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">L</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="mi">13</span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="mi">22</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Cle</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">Mle</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">Kle</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">Me</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Mle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">Ce</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Cle</span><span class="o">*</span><span class="n">G</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">Me</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">Me</span><span class="p">,</span><span class="n">Ce</span></div>

<div class="viewcode-block" id="beam3e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam3e">[docs]</a><span class="k">def</span> <span class="nf">beam3e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">eo</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix for a 3D elastic Bernoulli</span>
<span class="sd">    beam element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">     </span>
<span class="sd">        ex = [x1 x2]</span>
<span class="sd">        ey = [y1 y2]</span>
<span class="sd">        ez = [z1 z2]            element node coordinates</span>
<span class="sd">        </span>
<span class="sd">        eo = [xz yz zz]         orientation of local z axis</span>
<span class="sd">        </span>
<span class="sd">        ep = [E G A Iy Iz Kv]   element properties</span>
<span class="sd">                                  E: Young&#39;s modulus</span>
<span class="sd">                                  G: Shear modulus</span>
<span class="sd">                                  A: Cross section area</span>
<span class="sd">                                 Iy: Moment of inertia, local y-axis</span>
<span class="sd">                                 Iz: Moment of inertia, local z-axis</span>
<span class="sd">                                 Kv: Saint-Venant&#39;s torsion constant</span>
<span class="sd">    </span>
<span class="sd">        eq = [qx qy qz qw]      distributed loads</span>

<span class="sd">    Returns:</span>

<span class="sd">        Ke                      beam stiffness matrix (12 x 12)</span>

<span class="sd">        fe                      equivalent nodal forces (12 x 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
    
    <span class="n">eo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eo</span><span class="o">*</span><span class="n">eo</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">eo</span><span class="o">/</span><span class="n">lc</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
    
    <span class="n">E</span><span class="p">,</span><span class="n">Gs</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Iy</span><span class="p">,</span><span class="n">Iz</span><span class="p">,</span><span class="n">Kv</span> <span class="o">=</span> <span class="n">ep</span>

    <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qz</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qw</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="p">,</span><span class="n">qy</span><span class="p">,</span><span class="n">qz</span><span class="p">,</span><span class="n">qw</span> <span class="o">=</span> <span class="n">eq</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iz</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iz</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iy</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iy</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Gs</span><span class="o">*</span><span class="n">Kv</span><span class="o">/</span><span class="n">L</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iy</span><span class="o">/</span><span class="n">L</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iz</span><span class="o">/</span><span class="n">L</span>

    <span class="n">Kle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">c</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">c</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">h</span>  <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="n">c</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="n">c</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="mi">0</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">h</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">fle</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">,</span> <span class="o">-</span><span class="n">qz</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">,</span> <span class="n">qz</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#An = np.append([n1,n2],[n3],0)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="p">])</span>
    
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Kle</span><span class="o">*</span><span class="n">G</span>
    <span class="n">fe</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">fle</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span></div>

<div class="viewcode-block" id="beam3s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.beam3s">[docs]</a><span class="k">def</span> <span class="nf">beam3s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">eo</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the variation of the section forces and displacements</span>
<span class="sd">    along a three-dimensional beam element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">     </span>
<span class="sd">        ex = [x1 x2]                element node coordinates</span>
<span class="sd">        ey = [y1 y2]</span>
<span class="sd">        ez = [z1 z2]</span>

<span class="sd">        eo = [xz yz zz]             orientation of local z axis</span>
<span class="sd">        </span>
<span class="sd">        ep = [E G A Iy Iz Kv]       element properties</span>
<span class="sd">                                      E: Young&#39;s modulus</span>
<span class="sd">                                      G: Shear modulus</span>
<span class="sd">                                      A: Cross section area</span>
<span class="sd">                                     Iy: Moment of inertia, local y-axis</span>
<span class="sd">                                     Iz: Moment of inertia, local z-axis</span>
<span class="sd">                                     Kv: Saint-Venant&#39;s torsion constant</span>

<span class="sd">        ed                          the element displacement vector from the</span>
<span class="sd">                                    global coordinate system</span>
<span class="sd">    </span>
<span class="sd">        eq = [qx qy qz qw]          the disibuted axial, transversal and</span>
<span class="sd">                                    torsional loads</span>

<span class="sd">        n                           the number of point in which displacements</span>
<span class="sd">                                    and section forces are to be computed</span>

<span class="sd">    Returns:</span>

<span class="sd">        es = [[N1,Vy1,Vz1,T1,My1,Mz1],  section forces in n points along</span>
<span class="sd">              [N2,Vy2,Vz2,T2,My2,Mz2],  the local x-axis</span>
<span class="sd">              [..,...,...,..,...,...],</span>
<span class="sd">              [Nn,Vyn,Vzn,Tn,Myn,Mzn]]</span>

<span class="sd">        edi = [[u1,v1,w1,fi1],          displacements in n points along</span>
<span class="sd">               [u2,v2,w2,fi2],          the local x-axis</span>
<span class="sd">               [..,..,..,...],</span>
<span class="sd">               [un,vn,wn,fin]]</span>

<span class="sd">        eci = [[x1],                    local x-coordinates of the evaluation</span>
<span class="sd">               [x2],                    points</span>
<span class="sd">               [..],</span>
<span class="sd">               [xn]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
    
    <span class="n">eo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eo</span><span class="o">*</span><span class="n">eo</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">eo</span><span class="o">/</span><span class="n">lc</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>

    <span class="n">EA</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">EIy</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">EIz</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">GKv</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ep</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qz</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">qw</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qx</span><span class="p">,</span><span class="n">qy</span><span class="p">,</span><span class="n">qz</span><span class="p">,</span><span class="n">qw</span> <span class="o">=</span> <span class="n">eq</span>

    <span class="n">ne</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="n">n</span>
        
    <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n3</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="p">])</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>    <span class="c1"># u is the local element displacement</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>        <span class="c1"># vector minus the particular solution</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>        <span class="c1"># to the beam&#39;s diff.eq:s</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span>               <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">)</span>  <span class="p">],</span>
        <span class="p">[</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EIz</span><span class="p">)],</span>
        <span class="p">[</span> <span class="n">qz</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EIy</span><span class="p">)],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">qw</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">GKv</span><span class="p">)</span> <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">qz</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EIy</span><span class="p">)</span> <span class="p">],</span>
        <span class="p">[</span> <span class="n">qy</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">EIz</span><span class="p">)</span> <span class="p">]</span>
    <span class="p">])</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>   <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>   <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">])</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="n">u</span>
    <span class="n">eci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ne</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ne</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">edi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ne</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ne</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">ne</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eci</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">EA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">EIz</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">EIy</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GKv</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">EIy</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">EIy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">EIz</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">EIz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">qy</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">qz</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">qw</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">qz</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">qy</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">edi</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">qx</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span><span class="p">),</span><span class="n">qy</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EIz</span><span class="p">),</span><span class="n">qz</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">EIy</span><span class="p">),</span><span class="o">-</span><span class="n">qw</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">GKv</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">es</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">edi</span><span class="p">,</span><span class="n">eci</span></div>
    
<div class="viewcode-block" id="flw2te"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2te">[docs]</a><span class="k">def</span> <span class="nf">flw2te</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness (conductivity) matrix for a triangular field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1 x2 x3]</span>
<span class="sd">        ey = [y1 y2 y3]     element coordinates</span>
<span class="sd">    </span>
<span class="sd">        ep = [t]            element thickness    </span>

<span class="sd">        D = [kxx kxy;</span>
<span class="sd">             kyx kyy]       constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">             eq             heat supply per unit volume</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        Ke                  element &#39;stiffness&#39; matrix (3 x 3)</span>

<span class="sd">        fe                  element load vector (3 x 1)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="n">eq</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">eq</span><span class="o">=</span><span class="mf">0.</span>
    
    <span class="n">exm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="n">eym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span>
    <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">exm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">eym</span><span class="o">.</span><span class="n">T</span><span class="p">]))</span>
    <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
    <span class="p">])</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">I</span>
    <span class="n">A</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
  
    <span class="n">Ke</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">A</span>
    <span class="n">fe</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">eq</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mi">3</span>
       
    <span class="k">if</span> <span class="n">eq</span><span class="o">==</span><span class="mf">0.</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span> <span class="n">fe</span></div>
    
<div class="viewcode-block" id="flw2ts"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2ts">[docs]</a><span class="k">def</span> <span class="nf">flw2ts</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute flows or corresponding quantities in the triangular field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1 x2 x3]</span>
<span class="sd">        ey = [y1 y2 y3]         element coordinates</span>
<span class="sd">                                 </span>
<span class="sd">             D = [kxx kxy</span>
<span class="sd">                  kyx kyy]      constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">             ed =[u1 u2 u3]     u1,u2,u3: nodal values</span>
<span class="sd">                  .. .. ..;</span>
<span class="sd">                  </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        es=[ qx qy ] </span>
<span class="sd">             ... ..]                element flows</span>
<span class="sd">    </span>
<span class="sd">        et=[ gx gy ]</span>
<span class="sd">             ... ..]                element gradients</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">qt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">exr</span><span class="p">,</span> <span class="n">eyr</span><span class="p">,</span> <span class="n">edr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ed</span><span class="p">):</span>
            <span class="n">exm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">exr</span><span class="p">)</span>
            <span class="n">eym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">eyr</span><span class="p">)</span>
            <span class="n">edm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">edr</span><span class="p">)</span>
            <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">exm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">eym</span><span class="o">.</span><span class="n">T</span><span class="p">]))</span>
            <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
            <span class="p">])</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">I</span>

            <span class="n">qs</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">edm</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">qt</span><span class="p">[</span><span class="n">row</span><span class="p">,:]</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">edm</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">qs</span><span class="p">,</span> <span class="n">qt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="n">eym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span>
        <span class="n">edm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
        <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">exm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">eym</span><span class="o">.</span><span class="n">T</span><span class="p">]))</span>
        <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">I</span>

        <span class="n">qs</span><span class="o">=-</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">edm</span><span class="o">.</span><span class="n">T</span>
        <span class="n">qt</span><span class="o">=</span><span class="n">B</span><span class="o">*</span><span class="n">edm</span><span class="o">.</span><span class="n">T</span>
    
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">qt</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="flw2qe"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2qe">[docs]</a><span class="k">def</span> <span class="nf">flw2qe</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness (conductivity) matrix for a triangular field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1, x2, x3, x4]</span>
<span class="sd">        ey = [y1, y2, y3, y4]   element coordinates</span>
<span class="sd">    </span>
<span class="sd">        ep = [t]                element thickness    </span>

<span class="sd">        D = [[kxx, kxy],</span>
<span class="sd">             [kyx, kyy]]        constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">        eq                      heat supply per unit volume</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        Ke                      element &#39;stiffness&#39; matrix (4 x 4)</span>

<span class="sd">        fe                      element load vector (4 x 1)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">yc</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="p">)</span>    
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xc</span><span class="p">],[</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yc</span><span class="p">],</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
    <span class="n">Ke1</span><span class="p">,</span><span class="n">fe1</span> <span class="o">=</span> <span class="n">statcon</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">]));</span>

    <span class="n">Ke</span> <span class="o">=</span> <span class="n">Ke1</span>
    <span class="n">fe</span> <span class="o">=</span> <span class="n">fe1</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span></div>

<div class="viewcode-block" id="flw2qs"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2qs">[docs]</a><span class="k">def</span> <span class="nf">flw2qs</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute flows or corresponding quantities in the</span>
<span class="sd">    quadrilateral field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1, x2, x3, x4]</span>
<span class="sd">        ey = [y1, y2, y3, y4]      element coordinates</span>
<span class="sd">    </span>
<span class="sd">        ep = [t]                   element thickness    </span>

<span class="sd">        D = [[kxx, kxy],</span>
<span class="sd">             [kyx, kyy]]           constitutive matrix</span>

<span class="sd">        ed = [[u1, u2, u3, u4],</span>
<span class="sd">              [.., .., .., ..]]    u1,u2,u3,u4: nodal values</span>
<span class="sd">    </span>
<span class="sd">        eq                         heat supply per unit volume</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        es = [[qx, qy],</span>
<span class="sd">              [.., ..]]            element flows</span>

<span class="sd">        et = [[gx, gy],</span>
<span class="sd">              [.., ..]]            element gradients</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">xm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">ym</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span>
    
    <span class="n">En</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
    <span class="p">])</span>
    <span class="n">ex1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xm</span><span class="p">])</span>
    <span class="n">ey1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ym</span><span class="p">])</span>
    <span class="n">ex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">xm</span><span class="p">])</span>
    <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ym</span><span class="p">])</span>
    <span class="n">ex3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">xm</span><span class="p">])</span>
    <span class="n">ey3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ym</span><span class="p">])</span>
    <span class="n">ex4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xm</span><span class="p">])</span>
    <span class="n">ey4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ym</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span><span class="n">ey1</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span><span class="n">ey2</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex3</span><span class="p">,</span><span class="n">ey3</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex4</span><span class="p">,</span><span class="n">ey4</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span><span class="n">ey1</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span><span class="n">ey2</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex3</span><span class="p">,</span><span class="n">ey3</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">,</span><span class="n">f1</span> <span class="o">=</span> <span class="n">flw2te</span><span class="p">(</span><span class="n">ex4</span><span class="p">,</span><span class="n">ey4</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">K</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ed</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ed</span><span class="p">])</span>
    
    <span class="n">ni</span><span class="p">,</span><span class="n">nj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="n">ni</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ni</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),[</span><span class="n">i</span><span class="p">])],</span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">solveq</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">s1</span><span class="p">,</span><span class="n">t1</span> <span class="o">=</span> <span class="n">flw2ts</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span><span class="n">ey1</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ni</span><span class="p">))]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">s2</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="n">flw2ts</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span><span class="n">ey2</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ni</span><span class="p">))]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">s3</span><span class="p">,</span><span class="n">t3</span> <span class="o">=</span> <span class="n">flw2ts</span><span class="p">(</span><span class="n">ex3</span><span class="p">,</span><span class="n">ey3</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ni</span><span class="p">))]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">s4</span><span class="p">,</span><span class="n">t4</span> <span class="o">=</span> <span class="n">flw2ts</span><span class="p">(</span><span class="n">ex4</span><span class="p">,</span><span class="n">ey4</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">En</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ni</span><span class="p">))]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="n">s3</span><span class="o">+</span><span class="n">s4</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">et</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">t2</span><span class="o">+</span><span class="n">t3</span><span class="o">+</span><span class="n">t4</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    
    <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">et</span></div>

<div class="viewcode-block" id="flw2i4e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2i4e">[docs]</a><span class="k">def</span> <span class="nf">flw2i4e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness (conductivity)</span>
<span class="sd">    matrix for 4 node isoparametric field element</span>

<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        ex = [x1 x2 x3 x4]  element coordinates</span>
<span class="sd">        ey = [y1 y2 y3 y4]</span>

<span class="sd">        ep = [t ir]         thickness and integration rule</span>

<span class="sd">        D  = [[kxx kxy],</span>
<span class="sd">              [kyx kyy]]    constitutive matrix</span>

<span class="sd">        eq                  heat supply per unit volume</span>

<span class="sd">    Returns:</span>
<span class="sd">        Ke                  element &#39;stiffness&#39; matrix (4 x 4)</span>
<span class="sd">        fe                  element load vector (4 x 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span>

    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g2</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

    <span class="n">Ke1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
    <span class="n">fe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobi determinant == 0&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">Ke1</span> <span class="o">=</span> <span class="n">Ke1</span><span class="o">+</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">fe1</span> <span class="o">=</span> <span class="n">fe1</span><span class="o">+</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="o">*</span><span class="n">t</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="o">*</span><span class="n">t</span><span class="p">,</span><span class="n">fe1</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">eq</span></div>

<div class="viewcode-block" id="flw2i4s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2i4s">[docs]</a><span class="k">def</span> <span class="nf">flw2i4s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute flows or corresponding quantities in the</span>
<span class="sd">    4 node isoparametric element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        ex = [x1 x2 x3 x4]         element coordinates</span>
<span class="sd">        ey = [y1 y2 y3 y4]</span>

<span class="sd">        ep = [t ir]                thickness and integration rule</span>

<span class="sd">        D  = [[kxx kxy],</span>
<span class="sd">              [kyx kyy]]           constitutive matrix</span>

<span class="sd">        ed = [u1, u2, u3, u4]      u1,u2,u3,u4: nodal values</span>

<span class="sd">    Returns:</span>
<span class="sd">        es = [[qx, qy],</span>
<span class="sd">              [.., ..]]             element flows</span>

<span class="sd">        et = [[qx, qy],</span>
<span class="sd">              [... ..]]             element gradients</span>

<span class="sd">        eci=[[ix1, iy1],            Gauss point location vector</span>
<span class="sd">             [...  ...],            nint: number of integration points</span>
<span class="sd">             [ix(nint), iy(nint)]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span>

    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g2</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

    <span class="n">eci</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">ed</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ed</span><span class="p">])</span>
        
    <span class="n">red</span><span class="p">,</span><span class="n">ced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">et</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobi determinatn == 0&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">T</span>
        <span class="n">et</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">et</span><span class="p">,</span><span class="n">eci</span></div>

<div class="viewcode-block" id="flw2i8e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2i8e">[docs]</a><span class="k">def</span> <span class="nf">flw2i8e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness (conductivity)</span>
<span class="sd">    matrix for 8 node isoparametric field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1, ..., x8]      element coordinates</span>
<span class="sd">        ey = [y1, ..., y8]</span>
<span class="sd">        </span>
<span class="sd">        ep = [t, ir]            thickness and integration rule</span>

<span class="sd">        D = [[kxx, kxy],</span>
<span class="sd">             [kyx, kyy]]        constitutive matrix</span>

<span class="sd">        eq                      heat supply per unit volume</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        Ke                      element &#39;stiffness&#39; matrix (8 x 8)</span>
<span class="sd">        fe                      element load vector (8 x 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span>

    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g2</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">))</span>

    <span class="n">Ke1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">fe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobideterminanten lika med noll!&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">Ke1</span> <span class="o">=</span> <span class="n">Ke1</span><span class="o">+</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">fe1</span> <span class="o">=</span> <span class="n">fe1</span><span class="o">+</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="o">*</span><span class="n">t</span><span class="p">,</span><span class="n">fe1</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">q</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="o">*</span><span class="n">t</span></div>

<div class="viewcode-block" id="flw2i8s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw2i8s">[docs]</a><span class="k">def</span> <span class="nf">flw2i8s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute flows or corresponding quantities in the</span>
<span class="sd">    8 node isoparametric element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        ex = [x1,x2,x3....,x8]     element coordinates</span>
<span class="sd">        ey = [y1,y2,y3....,y8]</span>

<span class="sd">        ep = [t,ir]                thickness and integration rule</span>

<span class="sd">        D  = [[kxx,kxy],</span>
<span class="sd">              [kyx,kyy]]           constitutive matrix</span>

<span class="sd">        ed = [u1,....,u8]          u1,....,u8: nodal values</span>

<span class="sd">    Returns:</span>
<span class="sd">        es = [[qx,qy],</span>
<span class="sd">              [..,..]]             element flows</span>

<span class="sd">        et = [[qx,qy],</span>
<span class="sd">              [..,..]]             element gradients</span>

<span class="sd">        eci=[[ix1,iy1],            Gauss point location vector</span>
<span class="sd">             [...,...],            nint: number of integration points</span>
<span class="sd">             [ix(nint),iy(nint)]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span>

    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g2</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xsi</span><span class="p">,</span><span class="n">xsi</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">eta</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">))</span>

    <span class="n">eci</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">ed</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ed</span><span class="p">])</span>
    <span class="n">red</span><span class="p">,</span><span class="n">ced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">et</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobi determinant == 0&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">T</span>
        <span class="n">et</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">et</span><span class="p">,</span><span class="n">eci</span></div>

<div class="viewcode-block" id="flw3i8e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw3i8e">[docs]</a><span class="k">def</span> <span class="nf">flw3i8e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness (conductivity)</span>
<span class="sd">    matrix for 8 node isoparametric field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1,x2,x3,...,x8]</span>
<span class="sd">        ey = [y1,y2,y3,...,y8]      element coordinates</span>
<span class="sd">        ez = [z1,z2,z3,...,z8]</span>

<span class="sd">        ep = [ir]                   Ir: Integration rule</span>

<span class="sd">        D = [[kxx,kxy,kxz],</span>
<span class="sd">             [kyx,kyy,kyz],</span>
<span class="sd">             [kzx,kzy,kzz]]         constitutive matrix</span>

<span class="sd">        eq                          heat supply per unit volume</span>

<span class="sd">    Output:</span>

<span class="sd">        Ke                          element &#39;stiffness&#39; matrix (8 x 8)</span>
<span class="sd">        fe                          element load vector (8 x 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span><span class="o">*</span><span class="n">ir</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span>
    
    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span><span class="o">*</span><span class="n">w1</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">27</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">27</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">I3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">zet</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">3</span>
    
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">/</span><span class="mf">8.</span>

    <span class="n">Ke1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">fe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobi determinant == 0&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">Ke1</span> <span class="o">=</span> <span class="n">Ke1</span><span class="o">+</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">fe1</span> <span class="o">=</span> <span class="n">fe1</span><span class="o">+</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="p">,</span><span class="n">fe1</span><span class="o">*</span><span class="n">q</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke1</span></div>

<div class="viewcode-block" id="flw3i8s"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.flw3i8s">[docs]</a><span class="k">def</span> <span class="nf">flw3i8s</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute flows or corresponding quantities in the</span>
<span class="sd">    8 node (3-dim) isoparametric field element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1,x2,x3,...,x8]</span>
<span class="sd">        ey = [y1,y2,y3,...,y8]              element coordinates</span>
<span class="sd">        ez = [z1,z2,z3,...,z8]</span>

<span class="sd">        ep = [ir]                           Ir: Integration rule</span>

<span class="sd">        D = [[kxx,kxy,kxz],</span>
<span class="sd">             [kyx,kyy,kyz],</span>
<span class="sd">             [kzx,kzy,kzz]]                 constitutive matrix</span>

<span class="sd">        ed = [[u1,....,u8],                 element nodal values</span>
<span class="sd">              [..,....,..]]</span>

<span class="sd">    Output:</span>

<span class="sd">        es = [[qx,qy,qz],</span>
<span class="sd">              [..,..,..]]                   element flows(s)</span>

<span class="sd">        et = [[qx,qy,qz],                   element gradients(s)</span>
<span class="sd">              [..,..,..]]</span>

<span class="sd">        eci = [[ix1,ix1,iz1],               location vector</span>
<span class="sd">               [...,...,...],               nint: number of integration points</span>
<span class="sd">               [ix(nint),iy(nint),iz(nint)]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ngp</span> <span class="o">=</span> <span class="n">ir</span><span class="o">*</span><span class="n">ir</span><span class="o">*</span><span class="n">ir</span>
    
    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span><span class="o">*</span><span class="n">w1</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">27</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">27</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="n">I1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">I3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I1</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span>
        <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g2</span><span class="o">+</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w1</span>
        <span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="n">I2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w2</span><span class="o">+</span><span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integration points not implemented&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">w</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">zet</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">3</span>
    
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">zet</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span>
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">/</span><span class="mf">8.</span>

    <span class="n">eci</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">ed</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ed</span><span class="p">])</span>
        <span class="n">red</span><span class="p">,</span><span class="n">ced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ez</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
    <span class="n">et</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobideterminanten lika med noll!&quot;</span><span class="p">)</span>
        <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">ed</span><span class="o">.</span><span class="n">T</span>
        <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">T</span>
        <span class="n">et</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">ngp</span><span class="o">*</span><span class="n">red</span><span class="p">:</span><span class="n">ngp</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">es</span><span class="p">,</span><span class="n">et</span><span class="p">,</span><span class="n">eci</span></div>

<div class="viewcode-block" id="plante"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.plante">[docs]</a><span class="k">def</span> <span class="nf">plante</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix for a triangular plane stress or plane strain element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ex = [x1,x2,x3]         element coordinates</span>
<span class="sd">        ey = [y1,y2,y3]</span>
<span class="sd">     </span>
<span class="sd">        ep = [ptype,t]          ptype: analysis type</span>
<span class="sd">                                t: thickness</span>
<span class="sd">     </span>
<span class="sd">        D                       constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">        eq = [[bx],               bx: body force x-dir</span>
<span class="sd">              [by]]               by: body force y-dir</span>
<span class="sd">              </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        Ke                      element stiffness matrix (6 x 6)</span>
<span class="sd">        fe                      equivalent nodal forces (6 x 1) (if eq is given)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ptype</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">ep</span>
    
    <span class="n">bx</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">by</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bx</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">])</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">]))</span>
    
    <span class="c1"># --------- plane stress --------------------------------------</span>
    
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        
        <span class="n">colD</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">colD</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">Cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cm</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span>
            
        <span class="n">Ke</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Dm</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">t</span>
        <span class="n">fe</span> <span class="o">=</span> <span class="n">A</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">t</span>
        
        <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ke</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span><span class="o">.</span><span class="n">T</span>
       
    <span class="c1">#--------- plane strain --------------------------------------       </span>
    
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,]</span>
            <span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="n">colD</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">colD</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span>

        <span class="n">Ke</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Dm</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">t</span>
        <span class="n">fe</span> <span class="o">=</span> <span class="n">A</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">t</span>
        
        <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ke</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span><span class="o">.</span><span class="n">T</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Error ! Check first argument, ptype=1 or 2 allowed&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span></div>

<div class="viewcode-block" id="plants"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.plants">[docs]</a><span class="k">def</span> <span class="nf">plants</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate element normal and shear stress for a</span>
<span class="sd">    triangular plane stress or plane strain element.</span>
<span class="sd">    </span>
<span class="sd">    INPUT:  ex = [x1 x2 x3]         element coordinates</span>
<span class="sd">           ey = [y1 y2 y3]</span>
<span class="sd">    </span>
<span class="sd">           ep = [ptype t ]         ptype: analysis type</span>
<span class="sd">                                   t: thickness</span>
<span class="sd">    </span>
<span class="sd">           D                       constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">           ed =[u1 u2 ...u6        element displacement vector</span>
<span class="sd">                ......     ]       one row for each element</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT: es = [ sigx sigy [sigz] tauxy   element stress matrix</span>
<span class="sd">                 ......                 ]  one row for each element</span>
<span class="sd">    </span>
<span class="sd">           et = [ epsx epsy [epsz] gamxy   element strain matrix</span>
<span class="sd">                 ......                 ]  one row for each element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ptype</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ed</span><span class="p">])</span>

    <span class="n">rowed</span><span class="o">=</span><span class="n">ed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rowex</span><span class="o">=</span><span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># --------- plane stress --------------------------------------</span>
    
    <span class="k">if</span> <span class="n">ptype</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        
        <span class="n">colD</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colD</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">Cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cm</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span>
            
        <span class="n">incie</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">rowex</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">incie</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">incie</span><span class="o">=</span><span class="mi">1</span>
      
        <span class="n">et</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rowed</span><span class="p">,</span><span class="n">colD</span><span class="p">])</span>
        <span class="n">es</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rowed</span><span class="p">,</span><span class="n">colD</span><span class="p">])</span>
        
        <span class="n">ie</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rowed</span><span class="p">):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> 
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">]]</span>
                <span class="p">)</span>
            
            <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
            
            <span class="n">ee</span><span class="o">=</span><span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">ie</span><span class="p">,:])</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="n">colD</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ss</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">colD</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ss</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span><span class="o">=</span><span class="n">Dm</span><span class="o">*</span><span class="n">ee</span>
                <span class="n">ee</span><span class="o">=</span><span class="n">Cm</span><span class="o">*</span><span class="n">ss</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span><span class="o">=</span><span class="n">Dm</span><span class="o">*</span><span class="n">ee</span>
    
            <span class="n">et</span><span class="p">[</span><span class="n">ie</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">T</span>
            <span class="n">es</span><span class="p">[</span><span class="n">ie</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">T</span>
    
            <span class="n">ie</span> <span class="o">=</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">incie</span>
                    
        <span class="k">return</span> <span class="n">es</span><span class="p">,</span> <span class="n">et</span>
        
    <span class="c1"># --------- plane strain --------------------------------------</span>
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1">#Implementation by LAPM</span>
        <span class="n">colD</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">incie</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">rowex</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">incie</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">incie</span><span class="o">=</span><span class="mi">1</span>
      
        <span class="n">et</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rowed</span><span class="p">,</span><span class="n">colD</span><span class="p">])</span>
        <span class="n">es</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rowed</span><span class="p">,</span><span class="n">colD</span><span class="p">])</span>
        
        <span class="n">ie</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="n">ee</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">colD</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rowed</span><span class="p">):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> 
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">]]</span>
                <span class="p">)</span>
            
            <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
            
            <span class="n">e</span><span class="o">=</span><span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">ie</span><span class="p">,:])</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="n">colD</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ee</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span><span class="o">=</span><span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ee</span><span class="o">=</span><span class="n">e</span>

            <span class="n">et</span><span class="p">[</span><span class="n">ie</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">T</span>
            <span class="n">es</span><span class="p">[</span><span class="n">ie</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">ee</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    
            <span class="n">ie</span> <span class="o">=</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">incie</span>
                
        <span class="k">return</span> <span class="n">es</span><span class="p">,</span> <span class="n">et</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error ! Check first argument, ptype=1 or 2 allowed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="plantf"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.plantf">[docs]</a><span class="k">def</span> <span class="nf">plantf</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">es</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute internal element force vector in a triangular element</span>
<span class="sd">    in plane stress or plane strain. </span>

<span class="sd">    Parameters:</span>

<span class="sd">        ex = [x1,x2,x3]                 node coordinates</span>
<span class="sd">        ey = [y1,y2,y3]</span>

<span class="sd">        ep = [ptype,t]                  ptype: analysis type</span>
<span class="sd">                                        t: thickness</span>

<span class="sd">        es = [[sigx,sigy,[sigz],tauxy]  element stress matrix</span>
<span class="sd">              [  ......              ]] one row for each element</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        fe = [[f1],[f2],...,[f8]]       internal force vector</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ptype</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">ep</span>

    <span class="n">colD</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#--------- plane stress --------------------------------------</span>

    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">])</span>

        <span class="n">A</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">]))</span>

        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">colD</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">es</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>

        <span class="n">ef</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">stress</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ef</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1">#--------- plane strain --------------------------------------</span>
    
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span>    <span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">])</span>

        <span class="n">A</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">]))</span>

        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colD</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">es</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>

        <span class="n">ef</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">stress</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ef</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
  
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Error ! Check first argument, ptype=1 or 2 allowed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="platre"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.platre">[docs]</a><span class="k">def</span> <span class="nf">platre</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix for a rectangular plate element.</span>
<span class="sd">    NOTE! Element sides must be parallel to the coordinate axis.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">        ex = [x1,x2,x3,x4]          element coordinates</span>
<span class="sd">        ey = [y1,y2,y3,y4]</span>

<span class="sd">        ep = [t]                    thicknes</span>

<span class="sd">        D                           constitutive matrix for</span>
<span class="sd">                                    plane stress         </span>

<span class="sd">        eq = [qz]                   load/unit area</span>
<span class="sd">    Returns:</span>

<span class="sd">        Ke                          element stiffness matrix (12 x 12)</span>
<span class="sd">        fe                          equivalent nodal forces (12 x 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Lx</span> <span class="o">=</span> <span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">Ly</span> <span class="o">=</span> <span class="p">(</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">12.</span><span class="o">*</span><span class="n">D</span>

    <span class="n">A1</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="p">(</span><span class="n">Lx</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="p">(</span><span class="n">Ly</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">A3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Lx</span><span class="o">/</span><span class="n">Ly</span>
    <span class="n">A4</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="p">(</span><span class="n">Lx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">A5</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="p">(</span><span class="n">Ly</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">A6</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Lx</span>
    <span class="n">A7</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ly</span>
    <span class="n">A8</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="n">Lx</span>
    <span class="n">A9</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="n">Ly</span>

    <span class="n">C1</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A1</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">5.6</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">A1</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">5.6</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C3</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A1</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">5.6</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">A1</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">5.6</span><span class="o">*</span><span class="n">A3</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C5</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A5</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C6</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A4</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">C7</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A5</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C8</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A4</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C9</span> <span class="o">=</span> <span class="n">A5</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C10</span> <span class="o">=</span> <span class="n">A4</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C11</span> <span class="o">=</span> <span class="n">A5</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A6</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C12</span> <span class="o">=</span> <span class="n">A4</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.4</span><span class="o">*</span><span class="n">A7</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">C13</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C14</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C15</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C16</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C17</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C18</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C19</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C20</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">A8</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="mf">15.</span><span class="o">*</span><span class="n">A9</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">C21</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Keq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)))</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C1</span><span class="p">,</span><span class="n">C5</span><span class="p">,</span><span class="o">-</span><span class="n">C6</span><span class="p">,</span><span class="n">C2</span><span class="p">,</span><span class="n">C9</span><span class="p">,</span><span class="o">-</span><span class="n">C8</span><span class="p">,</span><span class="n">C4</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="o">-</span><span class="n">C12</span><span class="p">,</span><span class="n">C3</span><span class="p">,</span><span class="n">C7</span><span class="p">,</span><span class="o">-</span><span class="n">C10</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C13</span><span class="p">,</span><span class="o">-</span><span class="n">C21</span><span class="p">,</span><span class="n">C9</span><span class="p">,</span><span class="n">C15</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">C11</span><span class="p">,</span><span class="n">C19</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">C7</span><span class="p">,</span><span class="n">C17</span><span class="p">,</span><span class="mi">0</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C14</span><span class="p">,</span><span class="n">C8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C18</span><span class="p">,</span><span class="n">C12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C20</span><span class="p">,</span><span class="o">-</span><span class="n">C10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C16</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C1</span><span class="p">,</span><span class="n">C5</span><span class="p">,</span><span class="n">C6</span><span class="p">,</span><span class="n">C3</span><span class="p">,</span><span class="n">C7</span><span class="p">,</span><span class="n">C10</span><span class="p">,</span><span class="n">C4</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="n">C12</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C13</span><span class="p">,</span><span class="n">C21</span><span class="p">,</span><span class="o">-</span><span class="n">C7</span><span class="p">,</span><span class="n">C17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">C11</span><span class="p">,</span><span class="n">C19</span><span class="p">,</span><span class="mi">0</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C14</span><span class="p">,</span><span class="n">C10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C16</span><span class="p">,</span><span class="o">-</span><span class="n">C12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C20</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C1</span><span class="p">,</span><span class="o">-</span><span class="n">C5</span><span class="p">,</span><span class="n">C6</span><span class="p">,</span><span class="n">C2</span><span class="p">,</span><span class="o">-</span><span class="n">C9</span><span class="p">,</span><span class="n">C8</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C13</span><span class="p">,</span><span class="o">-</span><span class="n">C21</span><span class="p">,</span><span class="o">-</span><span class="n">C9</span><span class="p">,</span><span class="n">C15</span><span class="p">,</span><span class="mi">0</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C14</span><span class="p">,</span><span class="o">-</span><span class="n">C8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">C18</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C1</span><span class="p">,</span><span class="o">-</span><span class="n">C5</span><span class="p">,</span><span class="o">-</span><span class="n">C6</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">C13</span><span class="p">,</span><span class="n">C21</span>
    <span class="n">Keq</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">C14</span>
    <span class="n">Keq</span> <span class="o">=</span> <span class="n">Keq</span><span class="o">.</span><span class="n">T</span><span class="o">+</span><span class="n">Keq</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Keq</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">eq</span>
        <span class="n">R1</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">Lx</span><span class="o">*</span><span class="n">Ly</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">R2</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">Lx</span><span class="o">*</span><span class="n">Ly</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">24</span>
        <span class="n">R3</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">Ly</span><span class="o">*</span><span class="n">Lx</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">24</span>

        <span class="n">feq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">R1</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="o">-</span><span class="n">R3</span><span class="p">,</span><span class="n">R1</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="n">R3</span><span class="p">,</span><span class="n">R1</span><span class="p">,</span><span class="o">-</span><span class="n">R2</span><span class="p">,</span><span class="n">R3</span><span class="p">,</span><span class="n">R1</span><span class="p">,</span><span class="o">-</span><span class="n">R2</span><span class="p">,</span><span class="o">-</span><span class="n">R3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Keq</span><span class="p">,</span><span class="n">feq</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Keq</span></div>

<div class="viewcode-block" id="planqe"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.planqe">[docs]</a><span class="k">def</span> <span class="nf">planqe</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix for a quadrilateral</span>
<span class="sd">    plane stress or plane strain element.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ex=[x1 x2 x3 x4]    element coordinates</span>
<span class="sd">        ey=[y1 y2 y3 y4]</span>
<span class="sd">                                </span>
<span class="sd">        ep = [ptype, t]     ptype: analysis type</span>
<span class="sd">                            t: element thickness </span>

<span class="sd">        D                   constitutive matrix</span>

<span class="sd">        eq = [bx;           bx: body force in x direction</span>
<span class="sd">              by]           by: body force in y direction</span>

<span class="sd">    OUTPUT: Ke :  element stiffness matrix (8 x 8)</span>
<span class="sd">            fe : equivalent nodal forces (row array)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">f</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">xm</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">ym</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    
    <span class="n">b1</span> <span class="o">=</span> <span class="n">eq</span> <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]])</span>
    
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="p">]),</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ym</span><span class="p">]),</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">xm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ym</span><span class="p">]),</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ym</span><span class="p">]),</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">Ke</span><span class="p">,</span> <span class="n">fe</span> <span class="o">=</span> <span class="n">statcon</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">9</span><span class="p">],[</span><span class="mi">10</span><span class="p">]]))</span>
    
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ke</span><span class="p">,</span><span class="n">fe</span></div>
        

<div class="viewcode-block" id="planqs"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.planqs">[docs]</a><span class="k">def</span> <span class="nf">planqs</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate element normal and shear stress for a quadrilateral </span>
<span class="sd">    plane stress or plane strain element.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">            ex = [x1 x2 x3 x4]      element coordinates</span>
<span class="sd">            ey = [y1 y2 y3 y4]</span>
<span class="sd">    </span>
<span class="sd">            ep = [ptype, t]         ptype: analysis type</span>
<span class="sd">                                    t:  thickness</span>
<span class="sd">                                   </span>
<span class="sd">            D                       constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">            ed = [u1 u2 ..u8]       element displacement vector</span>
<span class="sd">    </span>
<span class="sd">            eq = [[bx]               bx: body force in x direction</span>
<span class="sd">                  [by]]              by: body force in y direction</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT: es = [ sigx sigy (sigz) tauxy]    element stress array</span>
<span class="sd">            et = [ epsx epsy (epsz) gamxy]    element strain array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span> <span class="ow">or</span> <span class="n">ey</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span> <span class="ow">or</span> <span class="n">ed</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error ! PLANQS: only one element at the time (ex, ey, ed must be a row arrays)&#39;</span><span class="p">)</span>

    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">xm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">ym</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
        
    <span class="n">b1</span> <span class="o">=</span> <span class="n">eq</span> <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]])</span>
    
    <span class="n">ex1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xm</span><span class="p">])</span> 
    <span class="n">ey1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="p">])</span>
    <span class="n">ex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xm</span><span class="p">])</span> 
    <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ym</span><span class="p">])</span>
    <span class="n">ex3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">xm</span><span class="p">])</span> 
    <span class="n">ey3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ym</span><span class="p">])</span>
    <span class="n">ex4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xm</span><span class="p">])</span> 
    <span class="n">ey4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ym</span><span class="p">])</span>
    
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">ey1</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span><span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span> <span class="n">ey2</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">ex3</span><span class="p">,</span> <span class="n">ey3</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    <span class="n">ke1</span><span class="p">,</span> <span class="n">fe1</span> <span class="o">=</span> <span class="n">plante</span><span class="p">(</span><span class="n">ex4</span><span class="p">,</span> <span class="n">ey4</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="n">K</span><span class="p">,</span> <span class="n">ke1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fe1</span><span class="p">)</span>
    
    <span class="n">A1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ex1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ey1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ex2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ey2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">A3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ex3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ey3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">A4</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ex4</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">ey4</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">Atot</span> <span class="o">=</span> <span class="n">A1</span><span class="o">+</span><span class="n">A2</span><span class="o">+</span><span class="n">A3</span><span class="o">+</span><span class="n">A4</span><span class="p">;</span>
    
    
    <span class="n">a</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">solveq</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)),</span> <span class="n">ed</span><span class="p">)</span>
        
<span class="c1">#    ni = ed.shape[0]</span>
<span class="c1">#    a = np.mat(empty((10,ni)))</span>
<span class="c1">#    for i in range(ni):</span>
<span class="c1">#        a[:,i] = solveq(K, f, np.array(range(1,9)), ed[i,:])[0]</span>
<span class="c1">#        #a = np.hstack([a, solveq(K, f, np.hstack([matrix(range(1,9)).T, ed[i,:].T]) ) ])</span>
    
    <span class="n">s1</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">plants</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">ey1</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">a</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">);</span>
    <span class="n">s2</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">plants</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span> <span class="n">ey2</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">a</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">);</span>
    <span class="n">s3</span><span class="p">,</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">plants</span><span class="p">(</span><span class="n">ex3</span><span class="p">,</span> <span class="n">ey3</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">a</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">);</span>
    <span class="n">s4</span><span class="p">,</span> <span class="n">t4</span> <span class="o">=</span> <span class="n">plants</span><span class="p">(</span><span class="n">ex4</span><span class="p">,</span> <span class="n">ey4</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">a</span><span class="p">[[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="p">);</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">A1</span><span class="o">+</span><span class="n">s2</span><span class="o">*</span><span class="n">A2</span><span class="o">+</span><span class="n">s3</span><span class="o">*</span><span class="n">A3</span><span class="o">+</span><span class="n">s4</span><span class="o">*</span><span class="n">A4</span><span class="p">)</span><span class="o">/</span><span class="n">Atot</span><span class="p">;</span>
    <span class="n">et</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">*</span><span class="n">A1</span><span class="o">+</span><span class="n">t2</span><span class="o">*</span><span class="n">A2</span><span class="o">+</span><span class="n">t3</span><span class="o">*</span><span class="n">A3</span><span class="o">+</span><span class="n">t4</span><span class="o">*</span><span class="n">A4</span><span class="p">)</span><span class="o">/</span><span class="n">Atot</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="n">es</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">et</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#[0] because these are 1-by-3 arrays and we want row arrays out.</span></div>


<div class="viewcode-block" id="plani4e"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.plani4e">[docs]</a><span class="k">def</span> <span class="nf">plani4e</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">ep</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">eq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stiffness matrix for a 4 node isoparametric</span>
<span class="sd">    element in plane strain or plane stress.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        ex = [x1 ...   x4]  element coordinates. Row array</span>
<span class="sd">        ey = [y1 ...   y4]</span>
<span class="sd">                                </span>
<span class="sd">        ep =[ptype, t, ir]  ptype: analysis type</span>
<span class="sd">                            t : thickness</span>
<span class="sd">                            ir: integration rule</span>
<span class="sd">    </span>
<span class="sd">        D                   constitutive matrix</span>
<span class="sd">    </span>
<span class="sd">        eq = [bx; by]       bx: body force in x direction</span>
<span class="sd">                            by: body force in y direction</span>
<span class="sd">                                Any array with 2 elements acceptable</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Ke : element stiffness matrix (8 x 8)</span>
<span class="sd">        fe : equivalent nodal forces (8 x 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ptype</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">t</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  
    <span class="n">ir</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  
    <span class="n">ngp</span><span class="o">=</span><span class="n">ir</span><span class="o">*</span><span class="n">ir</span>
    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#--------- gauss points --------------------------------------    </span>
    <span class="k">if</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.577350269189626</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">ir</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.774596669241483</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">0.555555555555555</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="mf">0.888888888888888</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g2</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span><span class="o">-</span><span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span><span class="p">]])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w1</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Used number of integrat     ion points not implemented&quot;</span><span class="p">)</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">xsi</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ngp</span><span class="o">*</span><span class="mi">2</span>
    <span class="c1"># Shape Functions</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dNr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">r2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">dNr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xsi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

<span class="c1">#</span>
    <span class="n">Ke1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
    <span class="n">fe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">JT</span> <span class="o">=</span> <span class="n">dNr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> 
    <span class="c1"># --------- plane stress --------------------------------------</span>
    <span class="k">if</span> <span class="n">ptype</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">colD</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">D</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">colD</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">Cm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="n">Dm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cm</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dm</span><span class="o">=</span><span class="n">D</span>          
<span class="c1">#</span>
        <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
        <span class="n">N2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
            <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobi determinant equal or less than zero!&quot;</span><span class="p">)</span>
            <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>  
            <span class="n">dNx</span><span class="o">=</span><span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
<span class="c1">#   </span>
            <span class="n">index_array_even</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">index_array_odd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
<span class="c1">#    </span>
            <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>    
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_array_even</span><span class="p">:</span>      
                <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">N2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#</span>
            <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>    
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_array_odd</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>   <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>   <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">N2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>  <span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#   </span>
            <span class="n">Ke1</span> <span class="o">=</span> <span class="n">Ke1</span><span class="o">+</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">Dm</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">t</span>
            <span class="n">fe1</span> <span class="o">=</span> <span class="n">fe1</span> <span class="o">+</span> <span class="n">N2</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">detJ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span>

        <span class="k">return</span> <span class="n">Ke1</span><span class="p">,</span><span class="n">fe1</span>
<span class="c1">#--------- plane strain --------------------------------------</span>
    <span class="k">elif</span> <span class="n">ptype</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
<span class="c1">#      </span>
        <span class="n">colD</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">D</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">colD</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dm</span> <span class="o">=</span> <span class="n">D</span>
<span class="c1">#</span>
        <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
        <span class="n">N2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngp</span><span class="p">):</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
            <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="k">if</span> <span class="n">detJ</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Jacobideterminant equal or less than zero!&quot;</span><span class="p">)</span>
            <span class="n">JTinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JT</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>  
            <span class="n">dNx</span><span class="o">=</span><span class="n">JTinv</span><span class="o">*</span><span class="n">dNr</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
<span class="c1">#   </span>
            <span class="n">index_array_even</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">index_array_odd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
<span class="c1">#    </span>
            <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>    
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_array_even</span><span class="p">:</span>
<span class="c1">#</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">N2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
<span class="c1">#</span>
                <span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#</span>
            <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>    
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_array_odd</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>   <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>   <span class="o">=</span> <span class="n">dNx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">N2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>  <span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">counter</span><span class="p">]</span>
                <span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#   </span>
            <span class="n">Ke1</span> <span class="o">=</span> <span class="n">Ke1</span> <span class="o">+</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">Dm</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">detJ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span>
            <span class="n">fe1</span> <span class="o">=</span> <span class="n">fe1</span><span class="o">+</span><span class="n">N2</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">t</span>
        <span class="k">return</span> <span class="n">Ke1</span><span class="p">,</span><span class="n">fe1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;Error ! Check first argument, ptype=1 or 2 allowed&quot;</span><span class="p">)</span></div>
        
 
<div class="viewcode-block" id="assem"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.assem">[docs]</a><span class="k">def</span> <span class="nf">assem</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">Ke</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assemble element matrices Ke ( and fe ) into the global</span>
<span class="sd">    stiffness matrix K ( and the global force vector f )</span>
<span class="sd">    according to the topology matrix edof.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        edof        dof topology array</span>
<span class="sd">        K           the global stiffness matrix</span>
<span class="sd">        Ke          element stiffness matrix</span>
<span class="sd">        f           the global force vector</span>
<span class="sd">        fe          element force vector</span>
<span class="sd">        </span>
<span class="sd">    Output parameters:</span>
<span class="sd">    </span>
<span class="sd">        K           the new global stiffness matrix</span>
<span class="sd">        f           the new global force vector</span>
<span class="sd">        fe          element force vector</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">edof</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">edof</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">)]</span> <span class="o">+</span> <span class="n">Ke</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">fe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">f</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">+</span> <span class="n">fe</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">edof</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">row</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">)]</span> <span class="o">+</span> <span class="n">Ke</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">fe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">f</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">+</span> <span class="n">fe</span>
            
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K</span><span class="p">,</span><span class="n">f</span></div>
            
<div class="viewcode-block" id="solveq"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.solveq">[docs]</a><span class="k">def</span> <span class="nf">solveq</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bcPrescr</span><span class="p">,</span><span class="n">bcVal</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve static FE-equations considering boundary conditions.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        K           global stiffness matrix, dim(K)= nd x nd</span>
<span class="sd">        f           global load vector, dim(f)= nd x 1</span>
<span class="sd">    </span>
<span class="sd">        bcPrescr    1-dim integer array containing prescribed dofs.</span>
<span class="sd">        bcVal       1-dim float array containing prescribed values.</span>
<span class="sd">                    If not given all prescribed dofs are assumed 0.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        a           solution including boundary values</span>
<span class="sd">        Q           reaction force vector</span>
<span class="sd">                    dim(a)=dim(Q)= nd x 1, nd : number of dof&#39;s</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="n">nDofs</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nPdofs</span> <span class="o">=</span> <span class="n">bcPrescr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">bcVal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bcVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nPdofs</span><span class="p">],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    
    <span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nDofs</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">)</span>    
    <span class="n">bcDofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nDofs</span><span class="p">)</span>
    
    <span class="n">bc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bcDofs</span> <span class="o">=</span> <span class="n">bcDofs</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span>
    
    <span class="n">fsys</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">bcDofs</span><span class="p">]</span><span class="o">-</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="n">bcDofs</span><span class="p">),(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">bcVal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPdofs</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">asys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="n">bcDofs</span><span class="p">),(</span><span class="n">bcDofs</span><span class="p">))],</span> <span class="n">fsys</span><span class="p">);</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nDofs</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">bcVal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPdofs</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcDofs</span><span class="p">)]</span> <span class="o">=</span> <span class="n">asys</span>
    
    <span class="n">Q</span><span class="o">=</span><span class="n">K</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="n">f</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">Q</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="spsolveq"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.spsolveq">[docs]</a><span class="k">def</span> <span class="nf">spsolveq</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bcPrescr</span><span class="p">,</span><span class="n">bcVal</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve static FE-equations considering boundary conditions.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        K           global stiffness matrix, dim(K)= nd x nd</span>
<span class="sd">        f           global load vector, dim(f)= nd x 1</span>
<span class="sd">    </span>
<span class="sd">        bcPrescr    1-dim integer array containing prescribed dofs.</span>
<span class="sd">        bcVal       1-dim float array containing prescribed values.</span>
<span class="sd">                    If not given all prescribed dofs are assumed 0.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        a           solution including boundary values</span>
<span class="sd">        Q           reaction force vector</span>
<span class="sd">                    dim(a)=dim(Q)= nd x 1, nd : number of dof&#39;s</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="n">nDofs</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nPdofs</span> <span class="o">=</span> <span class="n">bcPrescr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">bcVal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bcVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nPdofs</span><span class="p">],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    
    <span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nDofs</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">)</span>    
    <span class="n">bcDofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nDofs</span><span class="p">)</span>
    
    <span class="n">bc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bcDofs</span> <span class="o">=</span> <span class="n">bcDofs</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span>
    
    <span class="n">bcVal_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">bcVal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPdofs</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preparing system matrix...&quot;</span><span class="p">)</span>
    
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">bcDofs</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;step 1... converting K-&gt;CSR&quot;</span><span class="p">)</span>
    <span class="n">Kcsr</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">asformat</span><span class="p">(</span><span class="s2">&quot;csr&quot;</span><span class="p">)</span>    
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;step 2... Kt&quot;</span><span class="p">)</span>
    <span class="c1">#Kt1 = K[bcDofs]</span>
    <span class="c1">#Kt = Kt1[:,bcPrescr]</span>
    <span class="n">Kt</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">((</span><span class="n">bcDofs</span><span class="p">),(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;step 3... fsys&quot;</span><span class="p">)</span>
    <span class="n">fsys</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">bcDofs</span><span class="p">]</span><span class="o">-</span><span class="n">Kt</span><span class="o">*</span><span class="n">bcVal_m</span>
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;step 4... Ksys&quot;</span><span class="p">)</span>
    <span class="n">Ksys1</span> <span class="o">=</span> <span class="n">Kcsr</span><span class="p">[</span><span class="n">bcDofs</span><span class="p">]</span>
    <span class="n">Ksys</span> <span class="o">=</span> <span class="n">Ksys1</span><span class="p">[:,</span><span class="n">bcDofs</span><span class="p">]</span>
    <span class="c1">#Ksys = Kcsr[np.ix_((bcDofs),(bcDofs))]</span>
    <span class="n">info</span> <span class="p">(</span><span class="s2">&quot;done...&quot;</span><span class="p">)</span>
    
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solving system...&quot;</span><span class="p">)</span>
    <span class="n">asys</span> <span class="o">=</span> <span class="n">dsolve</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span><span class="n">Ksys</span><span class="p">,</span> <span class="n">fsys</span><span class="p">);</span>
    
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reconstructing full a...&quot;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nDofs</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcPrescr</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">bcVal_m</span>
    <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bcDofs</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">asys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    
    <span class="n">a_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">Q</span><span class="o">=</span><span class="n">K</span><span class="o">*</span><span class="n">a_m</span><span class="o">-</span><span class="n">f</span>
    <span class="n">info</span><span class="p">(</span><span class="s2">&quot;done...&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a_m</span><span class="p">,</span><span class="n">Q</span><span class="p">)</span></div>

<div class="viewcode-block" id="extractEldisp"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.extractEldisp">[docs]</a><span class="k">def</span> <span class="nf">extractEldisp</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract element displacements from the global displacement</span>
<span class="sd">    vector according to the topology matrix edof.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        a           the global displacement vector</span>
<span class="sd">        edof        dof topology array</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        ed:     element displacement array</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">if</span> <span class="n">edof</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">nDofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edof</span><span class="p">)</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nDofs</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">edof</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">ed</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nElements</span> <span class="o">=</span> <span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nDofs</span> <span class="o">=</span> <span class="n">edof</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nElements</span><span class="p">,</span><span class="n">nDofs</span><span class="p">])</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">edof</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">row</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        
    <span class="k">return</span> <span class="n">ed</span></div>

<span class="n">extract_eldisp</span> <span class="o">=</span> <span class="n">extractEldisp</span>

<div class="viewcode-block" id="statcon"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.statcon">[docs]</a><span class="k">def</span> <span class="nf">statcon</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">cd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Condensation of static FE-equations according to the vector cd.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        K                       global stiffness matrix, dim(K) = nd x nd</span>
<span class="sd">        f                       global load vector, dim(f)= nd x 1</span>

<span class="sd">        cd                      vector containing dof&#39;s to be eliminated</span>
<span class="sd">                                dim(cd)= nc x 1, nc: number of condensed dof&#39;s</span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        K1                      condensed stiffness matrix,</span>
<span class="sd">                                dim(K1)= (nd-nc) x (nd-nc)</span>
<span class="sd">        f1                      condensed load vector, dim(f1)= (nd-nc) x 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nd</span><span class="p">,</span><span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="p">(</span><span class="n">cd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
  
    <span class="n">aindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span>
    <span class="n">aindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">aindx</span><span class="p">,</span><span class="n">cd</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bindx</span> <span class="o">=</span> <span class="n">cd</span>

    <span class="n">Kaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">aindx</span><span class="p">,</span><span class="n">aindx</span><span class="p">)])</span>
    <span class="n">Kab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">aindx</span><span class="p">,</span><span class="n">bindx</span><span class="p">)])</span>
    <span class="n">Kbb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">bindx</span><span class="p">,</span><span class="n">bindx</span><span class="p">)])</span>

    <span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">aindx</span><span class="p">])</span>
    <span class="n">fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">bindx</span><span class="p">])</span>
    
    <span class="n">K1</span> <span class="o">=</span> <span class="n">Kaa</span><span class="o">-</span><span class="n">Kab</span><span class="o">*</span><span class="n">Kbb</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="n">Kab</span><span class="o">.</span><span class="n">T</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">fa</span><span class="o">-</span><span class="n">Kab</span><span class="o">*</span><span class="n">Kbb</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="n">fb</span>
    
    <span class="k">return</span> <span class="n">K1</span><span class="p">,</span><span class="n">f1</span></div>

<span class="k">def</span> <span class="nf">c_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">hex</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">long</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">dofHash</span><span class="p">(</span><span class="n">dof</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mh">0x345678</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dof</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">c_mul</span><span class="p">(</span><span class="mi">1000003</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">^</span> <span class="nb">hash</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">^</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="createdofs"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.createdofs">[docs]</a><span class="k">def</span> <span class="nf">createdofs</span><span class="p">(</span><span class="n">nCoords</span><span class="p">,</span><span class="n">nDof</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create dof array [nCoords x nDof]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nCoords</span><span class="o">*</span><span class="n">nDof</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nCoords</span><span class="p">,</span><span class="n">nDof</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span></div>

<div class="viewcode-block" id="coordxtr"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.coordxtr">[docs]</a><span class="k">def</span> <span class="nf">coordxtr</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="n">coords</span><span class="p">,</span><span class="n">dofs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create element coordinate matrices ex, ey, ez from edof</span>
<span class="sd">    coord and dofs matrices.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        edof            [nel x (nen * nnd)], nnd = number of node dofs</span>
<span class="sd">        coords          [ncoords x ndims],   ndims = node dimensions</span>
<span class="sd">        dofs            [ncoords x nnd]</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        ex              if ndims = 1</span>
<span class="sd">        ex, ey          if ndims = 2</span>
<span class="sd">        ex, ey, ez      if ndims = 3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create dictionary with dof indices</span>
    
    <span class="n">dofDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">nDofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nElements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nDimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nElementDofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">nElementNodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nElementDofs</span><span class="o">/</span><span class="n">nDofs</span><span class="p">)</span>
    
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">dofs</span><span class="p">:</span>
        <span class="n">dofDict</span><span class="p">[</span><span class="n">dofHash</span><span class="p">(</span><span class="n">dof</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
              
    <span class="c1"># Loop over edof and extract element coords</span>
    
    <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nElements</span><span class="p">,</span><span class="n">nElementNodes</span><span class="p">))</span>
    <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nElements</span><span class="p">,</span><span class="n">nElementNodes</span><span class="p">))</span>
    <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nElements</span><span class="p">,</span><span class="n">nElementNodes</span><span class="p">))</span>
    
    <span class="n">elementIdx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">etopo</span> <span class="ow">in</span> <span class="n">edof</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nElementNodes</span><span class="p">):</span>
            <span class="n">i0</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">nDofs</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">nDofs</span><span class="o">+</span><span class="n">nDofs</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">i0</span><span class="o">==</span><span class="n">i1</span><span class="p">:</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="p">[</span><span class="n">etopo</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">nDofs</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">etopo</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">nDofs</span><span class="p">:(</span><span class="n">i</span><span class="o">*</span><span class="n">nDofs</span><span class="o">+</span><span class="n">nDofs</span><span class="p">)]</span>
            
            <span class="n">nodeCoord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">dofDict</span><span class="p">[</span><span class="n">dofHash</span><span class="p">(</span><span class="n">dof</span><span class="p">)]]</span>
            
            <span class="k">if</span> <span class="n">nDimensions</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ex</span><span class="p">[</span><span class="n">elementIdx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodeCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nDimensions</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">ey</span><span class="p">[</span><span class="n">elementIdx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodeCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nDimensions</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ez</span><span class="p">[</span><span class="n">elementIdx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodeCoord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
        <span class="n">elementIdx</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="k">if</span> <span class="n">nDimensions</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ex</span>
    
    <span class="k">if</span> <span class="n">nDimensions</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span>
    
    <span class="k">if</span> <span class="n">nDimensions</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span></div>

<div class="viewcode-block" id="hooke"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.hooke">[docs]</a><span class="k">def</span> <span class="nf">hooke</span><span class="p">(</span><span class="n">ptype</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the material matrix for a linear</span>
<span class="sd">    elastic and isotropic material.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        ptype=  1:  plane stress</span>
<span class="sd">                2:  plane strain</span>
<span class="sd">                3:  axisymmetry</span>
<span class="sd">                4:  three dimensional</span>
<span class="sd">    </span>
<span class="sd">        E           Young&#39;s modulus</span>
<span class="sd">        v           Poissons const.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        D           material matrix</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
   
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
            <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
            <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
            <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
            <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cfinfo</span><span class="p">(</span><span class="s2">&quot;ptype not supported.&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">D</span></div>

<div class="viewcode-block" id="effmises"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.effmises">[docs]</a><span class="k">def</span> <span class="nf">effmises</span><span class="p">(</span><span class="n">es</span><span class="p">,</span><span class="n">ptype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate effective von mises stresses.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        es</span>
<span class="sd">    </span>
<span class="sd">        ptype=  1:  plane stress</span>
<span class="sd">                2:  plane strain</span>
<span class="sd">                3:  axisymmetry</span>
<span class="sd">                4:  three dimensional</span>
<span class="sd">    </span>
<span class="sd">       es = [[sigx,sigy,[sigz],tauxy]  element stress matrix</span>
<span class="sd">              [  ......              ]] one row for each element</span>
<span class="sd">              </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        eseff  = [eseff_0 .. eseff_nel-1]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">nel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">es</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">escomps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">eseff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nel</span><span class="p">])</span>
     
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sigxx</span> <span class="o">=</span> <span class="n">es</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sigyy</span> <span class="o">=</span> <span class="n">es</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sigxy</span> <span class="o">=</span> <span class="n">es</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eseff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigxx</span><span class="o">*</span><span class="n">sigxx</span><span class="o">+</span><span class="n">sigyy</span><span class="o">*</span><span class="n">sigyy</span><span class="o">-</span><span class="n">sigxx</span><span class="o">*</span><span class="n">sigyy</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">sigxy</span><span class="o">*</span><span class="n">sigxy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eseff</span></div>
    
<div class="viewcode-block" id="stress2nodal"><a class="viewcode-back" href="../../calfem_reference.html#calfem.core.stress2nodal">[docs]</a><span class="k">def</span> <span class="nf">stress2nodal</span><span class="p">(</span><span class="n">eseff</span><span class="p">,</span> <span class="n">edof</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert element effective stresses to nodal effective</span>
<span class="sd">    stresses.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        eseff  = [eseff_0 .. eseff_nel-1] </span>
<span class="sd">        edof   = [dof topology array]</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        ev:     element value array [[ev_0_0 ev_0_1 ev_0_nen-1 ]</span>
<span class="sd">                                      ..</span>
<span class="sd">                                      ev_nel-1_0 ev_nel-1_1 ev_nel-1_nen-1]</span>
<span class="sd">                      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">edof</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">elnodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">etopo</span><span class="p">,</span> <span class="n">eleseff</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span> <span class="n">eseff</span><span class="p">):</span>
        <span class="n">values</span><span class="p">[</span><span class="n">etopo</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">etopo</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eleseff</span> <span class="o">/</span> <span class="n">elnodes</span>
        
    <span class="n">evtemp</span> <span class="o">=</span> <span class="n">extractEldisp</span><span class="p">(</span><span class="n">edof</span><span class="p">,</span><span class="n">values</span><span class="p">)</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">evtemp</span><span class="p">[:,</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">elnodes</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
                     
    <span class="k">return</span> <span class="n">ev</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2020, Jonas Lindemann.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>